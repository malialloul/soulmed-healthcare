{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getSuggestionQuery = exports.isPropertyDefined = exports.handleResponseMSearch = exports.handleResponse = exports.handleError = exports.getQuerySuggestionsId = exports.isComponentActive = exports.handleTransformResponse = undefined;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.executeQueryListener = executeQueryListener;\n\nvar _misc = require('./misc');\n\nvar _hits = require('./hits');\n\nvar _transform = require('../../lib/utils/transform');\n\nvar handleTransformResponse = exports.handleTransformResponse = function handleTransformResponse() {\n  var res = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n  var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var component = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n\n  if (config.transformResponse && typeof config.transformResponse === 'function') {\n    return config.transformResponse(res, component);\n  }\n\n  return new Promise(function (resolve) {\n    return resolve(res);\n  });\n};\n\nvar isComponentActive = exports.isComponentActive = function isComponentActive() {\n  var getState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n  var componentId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n  var _getState = getState(),\n      components = _getState.components;\n\n  if (components.includes(componentId)) {\n    return true;\n  }\n\n  return false;\n};\n\nvar getQuerySuggestionsId = exports.getQuerySuggestionsId = function getQuerySuggestionsId() {\n  var componentId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return componentId + '__suggestions';\n};\n\nvar handleError = exports.handleError = function handleError() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref$orderOfQueries = _ref.orderOfQueries,\n      orderOfQueries = _ref$orderOfQueries === undefined ? [] : _ref$orderOfQueries,\n      _ref$error = _ref.error,\n      error = _ref$error === undefined ? null : _ref$error;\n\n  var getState = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};\n  var dispatch = arguments[2];\n\n  var _getState2 = getState(),\n      queryListener = _getState2.queryListener;\n\n  try {\n    console.error(JSON.stringify(error));\n  } catch (e) {\n    console.error(error);\n  }\n\n  orderOfQueries.forEach(function (component) {\n    if (isComponentActive(getState, component)) {\n      if (queryListener[component] && queryListener[component].onError) {\n        queryListener[component].onError(error);\n      }\n\n      dispatch((0, _misc.setError)(component, error));\n      dispatch((0, _misc.setLoading)(component, false));\n    }\n  });\n};\n\nvar handleResponse = exports.handleResponse = function handleResponse() {\n  var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      res = _ref2.res,\n      _ref2$orderOfQueries = _ref2.orderOfQueries,\n      orderOfQueries = _ref2$orderOfQueries === undefined ? [] : _ref2$orderOfQueries,\n      _ref2$appendToHits = _ref2.appendToHits,\n      appendToHits = _ref2$appendToHits === undefined ? false : _ref2$appendToHits,\n      _ref2$appendToAggs = _ref2.appendToAggs,\n      appendToAggs = _ref2$appendToAggs === undefined ? false : _ref2$appendToAggs,\n      _ref2$isSuggestionsQu = _ref2.isSuggestionsQuery,\n      isSuggestionsQuery = _ref2$isSuggestionsQu === undefined ? false : _ref2$isSuggestionsQu;\n\n  var getState = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};\n  var dispatch = arguments[2];\n\n  var _getState3 = getState(),\n      config = _getState3.config,\n      internalValues = _getState3.internalValues;\n\n  var searchId = res._headers ? res._headers.get('X-Search-Id') : null;\n\n  if (searchId) {\n    if (isSuggestionsQuery) {\n      dispatch((0, _misc.setSuggestionsSearchId)(searchId));\n    } else {\n      dispatch((0, _misc.setSearchId)(searchId));\n    }\n  }\n\n  orderOfQueries.forEach(function (component) {\n    if (isComponentActive(getState, component)) {\n      if (res.settings) {\n        dispatch((0, _misc.setAppliedSettings)(res.settings, component));\n      }\n\n      handleTransformResponse(res[component], config, component).then(function (response) {\n        if (response) {\n          var _getState4 = getState(),\n              timestamp = _getState4.timestamp;\n\n          if (timestamp[component] === undefined || timestamp[component] < res._timestamp) {\n            var promotedResults = response.promoted;\n\n            if (promotedResults) {\n              var parsedPromotedResults = promotedResults.map(function (promoted) {\n                return _extends({}, promoted.doc, {\n                  _position: promoted.position\n                });\n              });\n              dispatch((0, _misc.setPromotedResults)(parsedPromotedResults, component));\n            } else {\n              dispatch((0, _misc.setPromotedResults)([], component));\n            }\n\n            dispatch((0, _misc.setRawData)(component, response));\n            dispatch((0, _misc.setCustomData)(response.customData, component));\n\n            if (response.hits) {\n              dispatch((0, _misc.setTimestamp)(component, res._timestamp));\n              dispatch((0, _hits.updateHits)(component, response.hits, response.took, response.hits && response.hits.hidden, appendToHits));\n              var internalComponentID = (0, _transform.getInternalComponentID)(component);\n\n              if (internalValues[internalComponentID]) {\n                dispatch((0, _hits.saveQueryToHits)(component, internalValues[internalComponentID].value));\n              }\n            }\n\n            if (response.aggregations) {\n              dispatch((0, _hits.updateAggs)(component, response.aggregations, appendToAggs));\n              dispatch((0, _hits.updateCompositeAggs)(component, response.aggregations, appendToAggs));\n            }\n          }\n\n          dispatch((0, _misc.setLoading)(component, false));\n        }\n      }).catch(function (err) {\n        handleError({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    }\n  });\n};\n\nvar handleResponseMSearch = exports.handleResponseMSearch = function handleResponseMSearch(_ref3) {\n  var _ref3$res = _ref3.res,\n      res = _ref3$res === undefined ? {} : _ref3$res,\n      _ref3$isSuggestionsQu = _ref3.isSuggestionsQuery,\n      isSuggestionsQuery = _ref3$isSuggestionsQu === undefined ? false : _ref3$isSuggestionsQu,\n      _ref3$orderOfQueries = _ref3.orderOfQueries,\n      orderOfQueries = _ref3$orderOfQueries === undefined ? [] : _ref3$orderOfQueries,\n      _ref3$appendToHits = _ref3.appendToHits,\n      appendToHits = _ref3$appendToHits === undefined ? false : _ref3$appendToHits,\n      _ref3$appendToAggs = _ref3.appendToAggs,\n      appendToAggs = _ref3$appendToAggs === undefined ? false : _ref3$appendToAggs;\n  var getState = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {};\n  var dispatch = arguments[2];\n  orderOfQueries.forEach(function (component, index) {\n    if (isComponentActive(getState, component)) {\n      var searchId = res._headers ? res._headers.get('X-Search-Id') : null;\n\n      if (searchId) {\n        if (isSuggestionsQuery) {\n          dispatch((0, _misc.setSuggestionsSearchId)(searchId));\n        } else {\n          dispatch((0, _misc.setSearchId)(searchId));\n        }\n      }\n\n      var transformResponse = res;\n\n      if (res && Array.isArray(res.responses) && res.responses[index]) {\n        transformResponse = res.responses[index];\n      }\n\n      var _getState5 = getState(),\n          config = _getState5.config,\n          internalValues = _getState5.internalValues;\n\n      handleTransformResponse(transformResponse, config, component).then(function (response) {\n        var _getState6 = getState(),\n            timestamp = _getState6.timestamp;\n\n        if (timestamp[component] === undefined || timestamp[component] < res._timestamp) {\n          dispatch((0, _misc.setRawData)(component, response));\n          var promotedResults = response.promoted || res.promoted;\n\n          if (promotedResults) {\n            dispatch((0, _misc.setPromotedResults)(promotedResults, component));\n          } else {\n            dispatch((0, _misc.setPromotedResults)([], component));\n          }\n\n          if (response.hits) {\n            dispatch((0, _misc.setTimestamp)(component, res._timestamp));\n            dispatch((0, _hits.updateHits)(component, response.hits, response.took, response.hits && response.hits.hidden, appendToHits));\n            var internalComponentID = (0, _transform.getInternalComponentID)(component);\n\n            if (internalValues[internalComponentID]) {\n              dispatch((0, _hits.saveQueryToHits)(component, internalValues[internalComponentID].value));\n            }\n          }\n\n          if (response.aggregations) {\n            dispatch((0, _hits.updateAggs)(component, response.aggregations, appendToAggs));\n            dispatch((0, _hits.updateCompositeAggs)(component, response.aggregations, appendToAggs));\n          }\n        }\n\n        dispatch((0, _misc.setLoading)(component, false));\n      }).catch(function (err) {\n        handleError({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    }\n  });\n};\n\nvar isPropertyDefined = exports.isPropertyDefined = function isPropertyDefined(property) {\n  return property !== undefined && property !== null;\n};\n\nvar getSuggestionQuery = exports.getSuggestionQuery = function getSuggestionQuery() {\n  var getState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n  var componentId = arguments[1];\n\n  var _getState7 = getState(),\n      internalValues = _getState7.internalValues;\n\n  var internalValue = internalValues[componentId];\n  var value = internalValue && internalValue.value || '';\n  return [{\n    id: getQuerySuggestionsId(componentId),\n    dataField: ['key', 'key.autosuggest'],\n    size: 5,\n    value: value,\n    defaultQuery: {\n      query: {\n        bool: {\n          minimum_should_match: 1,\n          should: [{\n            function_score: {\n              field_value_factor: {\n                field: 'count',\n                modifier: 'sqrt',\n                missing: 1\n              }\n            }\n          }, {\n            multi_match: {\n              fields: ['key^9', 'key.autosuggest^1', 'key.keyword^10'],\n              fuzziness: 0,\n              operator: 'or',\n              query: value,\n              type: 'best_fields'\n            }\n          }, {\n            multi_match: {\n              fields: ['key^9', 'key.autosuggest^1', 'key.keyword^10'],\n              operator: 'or',\n              query: value,\n              type: 'phrase'\n            }\n          }, {\n            multi_match: {\n              fields: ['key^9'],\n              operator: 'or',\n              query: value,\n              type: 'phrase_prefix'\n            }\n          }]\n        }\n      }\n    }\n  }];\n};\n\nfunction executeQueryListener(listener, oldQuery, newQuery) {\n  if (listener && listener.onQueryChange) {\n    listener.onQueryChange(oldQuery, newQuery);\n  }\n}","map":{"version":3,"sources":["/home/ma/soulmed-healthcare/soulmed/node_modules/@appbaseio/reactivecore/lib/actions/utils.js"],"names":["Object","defineProperty","exports","value","getSuggestionQuery","isPropertyDefined","handleResponseMSearch","handleResponse","handleError","getQuerySuggestionsId","isComponentActive","handleTransformResponse","undefined","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","executeQueryListener","_misc","require","_hits","_transform","res","config","component","transformResponse","Promise","resolve","getState","componentId","_getState","components","includes","_ref","_ref$orderOfQueries","orderOfQueries","_ref$error","error","dispatch","_getState2","queryListener","console","JSON","stringify","e","forEach","onError","setError","setLoading","_ref2","_ref2$orderOfQueries","_ref2$appendToHits","appendToHits","_ref2$appendToAggs","appendToAggs","_ref2$isSuggestionsQu","isSuggestionsQuery","_getState3","internalValues","searchId","_headers","get","setSuggestionsSearchId","setSearchId","settings","setAppliedSettings","then","response","_getState4","timestamp","_timestamp","promotedResults","promoted","parsedPromotedResults","map","doc","_position","position","setPromotedResults","setRawData","setCustomData","customData","hits","setTimestamp","updateHits","took","hidden","internalComponentID","getInternalComponentID","saveQueryToHits","aggregations","updateAggs","updateCompositeAggs","catch","err","_ref3","_ref3$res","_ref3$isSuggestionsQu","_ref3$orderOfQueries","_ref3$appendToHits","_ref3$appendToAggs","index","Array","isArray","responses","_getState5","_getState6","property","_getState7","internalValue","id","dataField","size","defaultQuery","query","bool","minimum_should_match","should","function_score","field_value_factor","field","modifier","missing","multi_match","fields","fuzziness","operator","type","listener","oldQuery","newQuery","onQueryChange"],"mappings":"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","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:true});exports.getSuggestionQuery=exports.isPropertyDefined=exports.handleResponseMSearch=exports.handleResponse=exports.handleError=exports.getQuerySuggestionsId=exports.isComponentActive=exports.handleTransformResponse=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.executeQueryListener=executeQueryListener;var _misc=require('./misc');var _hits=require('./hits');var _transform=require('../../lib/utils/transform');var handleTransformResponse=exports.handleTransformResponse=function handleTransformResponse(){var res=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var config=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var component=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';if(config.transformResponse&&typeof config.transformResponse==='function'){return config.transformResponse(res,component);}return new Promise(function(resolve){return resolve(res);});};var isComponentActive=exports.isComponentActive=function isComponentActive(){var getState=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(){};var componentId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';var _getState=getState(),components=_getState.components;if(components.includes(componentId)){return true;}return false;};var getQuerySuggestionsId=exports.getQuerySuggestionsId=function getQuerySuggestionsId(){var componentId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';return componentId+'__suggestions';};var handleError=exports.handleError=function handleError(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$orderOfQueries=_ref.orderOfQueries,orderOfQueries=_ref$orderOfQueries===undefined?[]:_ref$orderOfQueries,_ref$error=_ref.error,error=_ref$error===undefined?null:_ref$error;var getState=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};var dispatch=arguments[2];var _getState2=getState(),queryListener=_getState2.queryListener;try{console.error(JSON.stringify(error));}catch(e){console.error(error);}orderOfQueries.forEach(function(component){if(isComponentActive(getState,component)){if(queryListener[component]&&queryListener[component].onError){queryListener[component].onError(error);}dispatch((0,_misc.setError)(component,error));dispatch((0,_misc.setLoading)(component,false));}});};var handleResponse=exports.handleResponse=function handleResponse(){var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},res=_ref2.res,_ref2$orderOfQueries=_ref2.orderOfQueries,orderOfQueries=_ref2$orderOfQueries===undefined?[]:_ref2$orderOfQueries,_ref2$appendToHits=_ref2.appendToHits,appendToHits=_ref2$appendToHits===undefined?false:_ref2$appendToHits,_ref2$appendToAggs=_ref2.appendToAggs,appendToAggs=_ref2$appendToAggs===undefined?false:_ref2$appendToAggs,_ref2$isSuggestionsQu=_ref2.isSuggestionsQuery,isSuggestionsQuery=_ref2$isSuggestionsQu===undefined?false:_ref2$isSuggestionsQu;var getState=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};var dispatch=arguments[2];var _getState3=getState(),config=_getState3.config,internalValues=_getState3.internalValues;var searchId=res._headers?res._headers.get('X-Search-Id'):null;if(searchId){if(isSuggestionsQuery){dispatch((0,_misc.setSuggestionsSearchId)(searchId));}else{dispatch((0,_misc.setSearchId)(searchId));}}orderOfQueries.forEach(function(component){if(isComponentActive(getState,component)){if(res.settings){dispatch((0,_misc.setAppliedSettings)(res.settings,component));}handleTransformResponse(res[component],config,component).then(function(response){if(response){var _getState4=getState(),timestamp=_getState4.timestamp;if(timestamp[component]===undefined||timestamp[component]<res._timestamp){var promotedResults=response.promoted;if(promotedResults){var parsedPromotedResults=promotedResults.map(function(promoted){return _extends({},promoted.doc,{_position:promoted.position});});dispatch((0,_misc.setPromotedResults)(parsedPromotedResults,component));}else{dispatch((0,_misc.setPromotedResults)([],component));}dispatch((0,_misc.setRawData)(component,response));dispatch((0,_misc.setCustomData)(response.customData,component));if(response.hits){dispatch((0,_misc.setTimestamp)(component,res._timestamp));dispatch((0,_hits.updateHits)(component,response.hits,response.took,response.hits&&response.hits.hidden,appendToHits));var internalComponentID=(0,_transform.getInternalComponentID)(component);if(internalValues[internalComponentID]){dispatch((0,_hits.saveQueryToHits)(component,internalValues[internalComponentID].value));}}if(response.aggregations){dispatch((0,_hits.updateAggs)(component,response.aggregations,appendToAggs));dispatch((0,_hits.updateCompositeAggs)(component,response.aggregations,appendToAggs));}}dispatch((0,_misc.setLoading)(component,false));}}).catch(function(err){handleError({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}});};var handleResponseMSearch=exports.handleResponseMSearch=function handleResponseMSearch(_ref3){var _ref3$res=_ref3.res,res=_ref3$res===undefined?{}:_ref3$res,_ref3$isSuggestionsQu=_ref3.isSuggestionsQuery,isSuggestionsQuery=_ref3$isSuggestionsQu===undefined?false:_ref3$isSuggestionsQu,_ref3$orderOfQueries=_ref3.orderOfQueries,orderOfQueries=_ref3$orderOfQueries===undefined?[]:_ref3$orderOfQueries,_ref3$appendToHits=_ref3.appendToHits,appendToHits=_ref3$appendToHits===undefined?false:_ref3$appendToHits,_ref3$appendToAggs=_ref3.appendToAggs,appendToAggs=_ref3$appendToAggs===undefined?false:_ref3$appendToAggs;var getState=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};var dispatch=arguments[2];orderOfQueries.forEach(function(component,index){if(isComponentActive(getState,component)){var searchId=res._headers?res._headers.get('X-Search-Id'):null;if(searchId){if(isSuggestionsQuery){dispatch((0,_misc.setSuggestionsSearchId)(searchId));}else{dispatch((0,_misc.setSearchId)(searchId));}}var transformResponse=res;if(res&&Array.isArray(res.responses)&&res.responses[index]){transformResponse=res.responses[index];}var _getState5=getState(),config=_getState5.config,internalValues=_getState5.internalValues;handleTransformResponse(transformResponse,config,component).then(function(response){var _getState6=getState(),timestamp=_getState6.timestamp;if(timestamp[component]===undefined||timestamp[component]<res._timestamp){dispatch((0,_misc.setRawData)(component,response));var promotedResults=response.promoted||res.promoted;if(promotedResults){dispatch((0,_misc.setPromotedResults)(promotedResults,component));}else{dispatch((0,_misc.setPromotedResults)([],component));}if(response.hits){dispatch((0,_misc.setTimestamp)(component,res._timestamp));dispatch((0,_hits.updateHits)(component,response.hits,response.took,response.hits&&response.hits.hidden,appendToHits));var internalComponentID=(0,_transform.getInternalComponentID)(component);if(internalValues[internalComponentID]){dispatch((0,_hits.saveQueryToHits)(component,internalValues[internalComponentID].value));}}if(response.aggregations){dispatch((0,_hits.updateAggs)(component,response.aggregations,appendToAggs));dispatch((0,_hits.updateCompositeAggs)(component,response.aggregations,appendToAggs));}}dispatch((0,_misc.setLoading)(component,false));}).catch(function(err){handleError({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}});};var isPropertyDefined=exports.isPropertyDefined=function isPropertyDefined(property){return property!==undefined&&property!==null;};var getSuggestionQuery=exports.getSuggestionQuery=function getSuggestionQuery(){var getState=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(){};var componentId=arguments[1];var _getState7=getState(),internalValues=_getState7.internalValues;var internalValue=internalValues[componentId];var value=internalValue&&internalValue.value||'';return[{id:getQuerySuggestionsId(componentId),dataField:['key','key.autosuggest'],size:5,value:value,defaultQuery:{query:{bool:{minimum_should_match:1,should:[{function_score:{field_value_factor:{field:'count',modifier:'sqrt',missing:1}}},{multi_match:{fields:['key^9','key.autosuggest^1','key.keyword^10'],fuzziness:0,operator:'or',query:value,type:'best_fields'}},{multi_match:{fields:['key^9','key.autosuggest^1','key.keyword^10'],operator:'or',query:value,type:'phrase'}},{multi_match:{fields:['key^9'],operator:'or',query:value,type:'phrase_prefix'}}]}}}}];};function executeQueryListener(listener,oldQuery,newQuery){if(listener&&listener.onQueryChange){listener.onQueryChange(oldQuery,newQuery);}}"]},"metadata":{},"sourceType":"script"}