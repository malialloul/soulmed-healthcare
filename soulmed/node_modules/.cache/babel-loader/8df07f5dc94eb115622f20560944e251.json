{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nexports.loadPopularSuggestions = loadPopularSuggestions;\nexports.executeQuery = executeQuery;\nexports.setQueryOptions = setQueryOptions;\nexports.updateQuery = updateQuery;\nexports.loadMore = loadMore;\n\nvar _value = require('./value');\n\nvar _utils = require('./utils');\n\nvar _misc = require('./misc');\n\nvar _helper = require('../utils/helper');\n\nvar _analytics = require('../utils/analytics');\n\nvar _analytics2 = _interopRequireDefault(_analytics);\n\nvar _maps = require('./maps');\n\nvar _graphQL = require('../utils/graphQL');\n\nvar _graphQL2 = _interopRequireDefault(_graphQL);\n\nvar _constants = require('../utils/constants');\n\nvar _transform = require('../utils/transform');\n\nvar _transform2 = require('../../lib/utils/transform');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction loadPopularSuggestions(componentId) {\n  return function (dispatch, getState) {\n    var _getState = getState(),\n        config = _getState.config,\n        appbaseRef = _getState.appbaseRef,\n        props = _getState.props,\n        internalValues = _getState.internalValues;\n\n    var isAppbaseEnabled = config && config.enableAppbase;\n    var componentProps = props[componentId] || {};\n    var internalValue = internalValues[componentId];\n    var value = internalValue && internalValue.value || '';\n\n    if (isAppbaseEnabled && (componentProps.enablePopularSuggestions || componentProps.enableQuerySuggestions)) {\n      var suggQuery = (0, _utils.getSuggestionQuery)(getState, componentId);\n      appbaseRef.getQuerySuggestions(suggQuery).then(function (suggestions) {\n        var querySuggestion = suggestions[(0, _utils.getQuerySuggestionsId)(componentId)];\n\n        if (value) {\n          dispatch((0, _misc.setPopularSuggestions)(querySuggestion && querySuggestion.hits && querySuggestion.hits.hits, componentId.split('__internal')[0]));\n        } else {\n          dispatch((0, _misc.setDefaultPopularSuggestions)(querySuggestion && querySuggestion.hits && querySuggestion.hits.hits, componentId.split('__internal')[0]));\n        }\n      }).catch(function (e) {\n        (0, _utils.handleError)({\n          orderOfQueries: [componentId],\n          error: e\n        }, getState, dispatch);\n      });\n    }\n  };\n}\n\nfunction msearch(query, orderOfQueries) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var isInternalComponent = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  var appendToAggs = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  var componentType = arguments[5];\n  return function (dispatch, getState) {\n    var _getState2 = getState(),\n        appbaseRef = _getState2.appbaseRef,\n        config = _getState2.config,\n        headers = _getState2.headers,\n        analytics = _getState2.analytics,\n        selectedValues = _getState2.selectedValues;\n\n    var searchHeaders = {};\n    var suggestionsComponents = [_constants.componentTypes.dataSearch, _constants.componentTypes.categorySearch];\n    var isSuggestionsQuery = isInternalComponent && suggestionsComponents.indexOf(componentType) !== -1;\n\n    if (config.analytics) {\n      if (config.analyticsConfig.suggestionAnalytics && isSuggestionsQuery) {\n        var suggestionsSearchValue = analytics.suggestionsSearchValue;\n        var shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || suggestionsSearchValue);\n\n        if (shouldIncludeQuery) {\n          searchHeaders = {\n            'X-Search-Query': suggestionsSearchValue || ''\n          };\n        }\n      } else {\n        var searchValue = analytics.searchValue,\n            searchId = analytics.searchId;\n        var filterString = (0, _analytics2.default)(selectedValues);\n\n        if (searchId) {\n          searchHeaders = _extends({\n            'X-Search-Id': searchId,\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        } else {\n          var _shouldIncludeQuery = !!(config.analyticsConfig.emptyQuery || searchValue);\n\n          searchHeaders = _extends(_shouldIncludeQuery && {\n            'X-Search-Query': searchValue || ''\n          }, filterString && {\n            'X-Search-Filters': filterString\n          });\n        }\n      }\n\n      if (config.analyticsConfig.searchStateHeader) {\n        var searchState = (0, _helper.getSearchState)(getState(), true);\n\n        if (searchState && Object.keys(searchState).length) {\n          searchHeaders['X-Search-State'] = JSON.stringify(searchState);\n        }\n      }\n\n      if (config.analyticsConfig.userId) {\n        searchHeaders['X-User-Id'] = config.analyticsConfig.userId;\n      }\n\n      if (config.analyticsConfig.customEvents) {\n        searchHeaders['X-Search-CustomEvent'] = (0, _analytics.parseCustomEvents)(config.analyticsConfig.customEvents);\n      }\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch((0, _misc.setLoading)(component, true));\n      dispatch((0, _misc.setError)(component, null));\n    });\n\n    if (config.graphQLUrl) {\n      (0, _graphQL2.default)(config.graphQLUrl, config.url, config.credentials, config.app, query).then(function (res) {\n        (0, _utils.handleResponseMSearch)({\n          res: res,\n          isSuggestionsQuery: isSuggestionsQuery,\n          orderOfQueries: orderOfQueries,\n          appendToHits: appendToHits,\n          appendToAggs: appendToAggs\n        }, getState, dispatch);\n      }).catch(function (err) {\n        (0, _utils.handleError)({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    } else {\n      appbaseRef.setHeaders(_extends({}, headers, searchHeaders));\n      appbaseRef.msearch({\n        type: config.type === '*' ? '' : config.type,\n        body: query\n      }).then(function (res) {\n        (0, _utils.handleResponseMSearch)({\n          res: res,\n          isSuggestionsQuery: isSuggestionsQuery,\n          orderOfQueries: orderOfQueries,\n          appendToHits: appendToHits,\n          appendToAggs: appendToAggs\n        }, getState, dispatch);\n      }).catch(function (err) {\n        (0, _utils.handleError)({\n          orderOfQueries: orderOfQueries,\n          error: err\n        }, getState, dispatch);\n      });\n    }\n  };\n}\n\nfunction appbaseSearch() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      query = _ref.query,\n      orderOfQueries = _ref.orderOfQueries,\n      _ref$appendToHits = _ref.appendToHits,\n      appendToHits = _ref$appendToHits === undefined ? false : _ref$appendToHits,\n      _ref$isSuggestionsQue = _ref.isSuggestionsQuery,\n      isSuggestionsQuery = _ref$isSuggestionsQue === undefined ? false : _ref$isSuggestionsQue,\n      searchComponentID = _ref.searchComponentID,\n      _ref$appendToAggs = _ref.appendToAggs,\n      appendToAggs = _ref$appendToAggs === undefined ? false : _ref$appendToAggs;\n\n  return function (dispatch, getState) {\n    var _getState3 = getState(),\n        appbaseRef = _getState3.appbaseRef,\n        config = _getState3.config,\n        headers = _getState3.headers;\n\n    var isAnalyticsEnabled = false;\n\n    if (config) {\n      if ((0, _utils.isPropertyDefined)(config.analytics)) {\n        isAnalyticsEnabled = config.analytics;\n      } else if (config.analyticsConfig) {\n        if ((0, _utils.isPropertyDefined)(config.analyticsConfig.recordAnalytics)) {\n          isAnalyticsEnabled = config.analyticsConfig.recordAnalytics;\n        } else if ((0, _utils.isPropertyDefined)(config.analyticsConfig.analytics)) {\n          isAnalyticsEnabled = config.analyticsConfig.analytics;\n        }\n      }\n    }\n\n    var settings = {\n      recordAnalytics: isAnalyticsEnabled\n    };\n\n    if (config.analyticsConfig) {\n      settings.userId = (0, _utils.isPropertyDefined)(config.analyticsConfig.userId) ? config.analyticsConfig.userId : undefined;\n      settings.enableQueryRules = (0, _utils.isPropertyDefined)(config.analyticsConfig.enableQueryRules) ? config.analyticsConfig.enableQueryRules : undefined;\n      settings.customEvents = (0, _utils.isPropertyDefined)(config.analyticsConfig.customEvents) ? config.analyticsConfig.customEvents : undefined;\n    }\n\n    orderOfQueries.forEach(function (component) {\n      dispatch((0, _misc.setLoading)(component, true));\n      dispatch((0, _misc.setError)(component, null));\n    });\n    appbaseRef.setHeaders(_extends({}, headers));\n\n    if (isSuggestionsQuery && searchComponentID) {\n      dispatch(loadPopularSuggestions(searchComponentID));\n    }\n\n    appbaseRef.reactiveSearchv3(query, settings).then(function (res) {\n      (0, _utils.handleResponse)({\n        res: res,\n        orderOfQueries: orderOfQueries,\n        appendToHits: appendToHits,\n        appendToAggs: appendToAggs\n      }, getState, dispatch);\n    }).catch(function (err) {\n      (0, _utils.handleError)({\n        orderOfQueries: orderOfQueries,\n        error: err\n      }, getState, dispatch);\n    });\n  };\n}\n\nvar requestStack = [];\nvar lock = false;\n\nfunction executeQuery(componentId) {\n  var executeWatchList = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var mustExecuteMapQuery = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var componentType = arguments[3];\n  var metaOptions = arguments[4];\n  return function (dispatch, getState) {\n    var _getState4 = getState(),\n        queryLog = _getState4.queryLog,\n        config = _getState4.config,\n        mapData = _getState4.mapData,\n        watchMan = _getState4.watchMan,\n        dependencyTree = _getState4.dependencyTree,\n        queryList = _getState4.queryList,\n        queryOptions = _getState4.queryOptions,\n        queryListener = _getState4.queryListener,\n        props = _getState4.props,\n        selectedValues = _getState4.selectedValues,\n        internalValues = _getState4.internalValues;\n\n    var lockTime = config.initialQueriesSyncTime;\n    var initialTimestamp = config.initialTimestamp;\n    var componentList = [componentId];\n    var finalQuery = [];\n    var appbaseQuery = {};\n    var orderOfQueries = [];\n    var isAppbaseEnabled = config && config.enableAppbase;\n\n    if (executeWatchList) {\n      var watchList = watchMan[componentId] || [];\n      componentList = [].concat(_toConsumableArray(componentList), _toConsumableArray(watchList));\n    }\n\n    var matchAllQuery = {\n      match_all: {}\n    };\n    componentList.forEach(function (component) {\n      var componentProps = props[component];\n\n      if (selectedValues[componentId] && selectedValues[componentId].reference !== 'URL' && [_constants.componentTypes.reactiveList, _constants.componentTypes.reactiveMap].includes(componentProps.componentType)) {\n        dispatch((0, _value.setValue)(component, null));\n      }\n\n      var _buildQuery = (0, _helper.buildQuery)(component, dependencyTree, queryList, queryOptions),\n          queryObj = _buildQuery.queryObj,\n          options = _buildQuery.options;\n\n      var validOptions = ['aggs', 'from', 'sort'];\n\n      if (queryObj && !!Object.keys(queryObj).length || options && Object.keys(options).some(function (item) {\n        return validOptions.includes(item);\n      })) {\n        if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n          queryObj = _extends({}, matchAllQuery);\n        }\n\n        var currentQuery = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var queryToLog = _extends({\n          query: _extends({}, queryObj)\n        }, options, queryOptions[component]);\n\n        var oldQuery = queryLog[component];\n\n        if (mustExecuteMapQuery || !(0, _helper.isEqual)(currentQuery, oldQuery)) {\n          orderOfQueries = [].concat(_toConsumableArray(orderOfQueries), [component]);\n          dispatch((0, _misc.logQuery)(component, queryToLog));\n          var isMapComponent = Object.keys(mapData).includes(component);\n\n          if (isMapComponent && mapData[component].query) {\n            var existingQuery = currentQuery.query;\n            currentQuery.query = {\n              bool: {\n                must: [existingQuery, mapData[component].query]\n              }\n            };\n\n            if (!mapData[component].persistMapQuery) {\n              dispatch((0, _maps.updateMapData)(componentId, null, false));\n            }\n\n            var _getState5 = getState(),\n                combinedLog = _getState5.combinedLog;\n\n            if ((0, _helper.isEqual)(combinedLog[component], currentQuery)) return;\n            dispatch((0, _misc.logCombinedQuery)(component, currentQuery));\n          }\n\n          (0, _utils.executeQueryListener)(queryListener[component], oldQuery, currentQuery);\n\n          if (isAppbaseEnabled) {\n            var value = void 0;\n            var isInternalComponent = componentId.endsWith('__internal');\n            var mainComponentProps = props[componentId];\n\n            if (isInternalComponent && (0, _transform.isSearchComponent)(mainComponentProps.componentType)) {\n              value = internalValues[componentId] && internalValues[componentId].value;\n            }\n\n            var query = (0, _transform.getRSQuery)(component, (0, _transform.extractPropsFromState)(getState(), component, _extends({}, value ? {\n              value: value\n            } : null, metaOptions ? {\n              from: metaOptions.from\n            } : null)));\n\n            if (query) {\n              appbaseQuery = _extends({}, appbaseQuery, _defineProperty({}, component, query), (0, _transform.getDependentQueries)(getState(), component, orderOfQueries));\n            }\n\n            if (isMapComponent) {\n              var internalComponent = (0, _transform2.getInternalComponentID)(component);\n              var internalQuery = (0, _transform.getRSQuery)(internalComponent, (0, _transform.extractPropsFromState)(getState(), internalComponent, metaOptions ? {\n                from: metaOptions.from\n              } : null));\n\n              if (internalQuery) {\n                appbaseQuery[internalComponent] = _extends({}, internalQuery, {\n                  execute: false\n                });\n              }\n            }\n          } else {\n            finalQuery = [].concat(_toConsumableArray(finalQuery), [{\n              preference: component\n            }, currentQuery]);\n          }\n        }\n      }\n    });\n\n    if (isAppbaseEnabled) {\n      finalQuery = Object.keys(appbaseQuery).map(function (component) {\n        return appbaseQuery[component];\n      });\n    }\n\n    if (finalQuery.length) {\n      if (isAppbaseEnabled) {\n        var suggestionsComponents = [_constants.componentTypes.dataSearch, _constants.componentTypes.categorySearch];\n        var isInternalComponent = componentId.endsWith('__internal');\n        var isSuggestionsQuery = isInternalComponent && suggestionsComponents.indexOf(componentType) !== -1;\n        var currentTime = new Date().getTime();\n\n        if (currentTime - initialTimestamp < lockTime) {\n          if (!lock) {\n            setTimeout(function () {\n              var finalOrderOfQueries = [];\n              var finalIsSuggestionsQuery = false;\n              var finalSearchComponentID = '';\n              var orderOfQueriesMap = {};\n              var processedQueriesMap = {};\n              var queryExecutionMap = {};\n              requestStack.forEach(function (request) {\n                if (!finalIsSuggestionsQuery) {\n                  finalIsSuggestionsQuery = request.isSuggestionsQuery;\n                }\n\n                if (!finalSearchComponentID) {\n                  finalSearchComponentID = request.searchComponentID;\n                }\n\n                if (Array.isArray(request.query)) {\n                  request.query.forEach(function (query) {\n                    if (query.execute) {\n                      queryExecutionMap[query.id] = query.execute;\n                    }\n\n                    var newQuery = query;\n\n                    if (queryExecutionMap[query.id]) {\n                      newQuery.execute = true;\n                    }\n\n                    processedQueriesMap[query.id] = newQuery;\n                  });\n                }\n\n                if (Array.isArray(request.orderOfQueries)) {\n                  request.orderOfQueries.forEach(function (query) {\n                    if (!orderOfQueriesMap[query.id]) {\n                      finalOrderOfQueries = [query].concat(_toConsumableArray(finalOrderOfQueries));\n                    } else {\n                      orderOfQueriesMap[query.id] = true;\n                    }\n                  });\n                }\n              });\n              var finalCombinedQuery = Object.values(processedQueriesMap);\n\n              if (finalCombinedQuery.length) {\n                dispatch(appbaseSearch({\n                  query: finalCombinedQuery,\n                  orderOfQueries: finalOrderOfQueries,\n                  isSuggestionsQuery: finalIsSuggestionsQuery,\n                  searchComponentID: finalSearchComponentID\n                }));\n              }\n\n              requestStack = [];\n            }, lockTime);\n          }\n\n          lock = true;\n          requestStack.push({\n            query: finalQuery,\n            orderOfQueries: orderOfQueries,\n            isSuggestionsQuery: isSuggestionsQuery,\n            searchComponentID: componentId\n          });\n        } else {\n          dispatch(appbaseSearch({\n            query: finalQuery,\n            orderOfQueries: orderOfQueries,\n            isSuggestionsQuery: isSuggestionsQuery,\n            searchComponentID: componentId\n          }));\n        }\n      } else {\n        dispatch(msearch(finalQuery, orderOfQueries, false, componentId.endsWith('__internal'), undefined, componentType));\n      }\n    }\n  };\n}\n\nfunction setQueryOptions(component, queryOptions) {\n  var execute = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return function (dispatch) {\n    dispatch((0, _misc.updateQueryOptions)(component, queryOptions));\n\n    if (execute) {\n      dispatch(executeQuery(component, true));\n    }\n  };\n}\n\nfunction updateQuery(_ref2) {\n  var componentId = _ref2.componentId,\n      query = _ref2.query,\n      value = _ref2.value,\n      _ref2$label = _ref2.label,\n      label = _ref2$label === undefined ? null : _ref2$label,\n      _ref2$showFilter = _ref2.showFilter,\n      showFilter = _ref2$showFilter === undefined ? true : _ref2$showFilter,\n      _ref2$URLParams = _ref2.URLParams,\n      URLParams = _ref2$URLParams === undefined ? false : _ref2$URLParams,\n      _ref2$componentType = _ref2.componentType,\n      componentType = _ref2$componentType === undefined ? null : _ref2$componentType,\n      _ref2$category = _ref2.category,\n      category = _ref2$category === undefined ? null : _ref2$category,\n      _ref2$meta = _ref2.meta,\n      meta = _ref2$meta === undefined ? {} : _ref2$meta;\n  var execute = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  return function (dispatch) {\n    var queryToDispatch = query;\n\n    if (query && query.query) {\n      queryToDispatch = query.query;\n    }\n\n    if (!componentId.endsWith('__internal')) {\n      dispatch((0, _value.setValue)(componentId, value, label, showFilter, URLParams, componentType, category, meta));\n\n      if (componentType === _constants.componentTypes.dynamicRangeSlider) {\n        dispatch((0, _value.setInternalValue)((0, _transform.getHistogramComponentID)(componentId), value, componentType, category, meta));\n      } else {\n        dispatch((0, _value.setInternalValue)(componentId + '__internal', value, componentType, category, meta));\n      }\n    } else {\n      dispatch((0, _value.setInternalValue)(componentId, value, componentType, category, meta));\n    }\n\n    dispatch((0, _misc.setQuery)(componentId, queryToDispatch));\n    if (execute) dispatch(executeQuery(componentId, true, false, componentType));\n  };\n}\n\nfunction loadMore(component, newOptions) {\n  var appendToHits = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var appendToAggs = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  return function (dispatch, getState) {\n    var store = getState();\n\n    var _buildQuery2 = (0, _helper.buildQuery)(component, store.dependencyTree, store.queryList, store.queryOptions),\n        queryObj = _buildQuery2.queryObj,\n        options = _buildQuery2.options;\n\n    var queryLog = store.queryLog;\n    if (!options) options = {};\n    options = _extends({}, options, newOptions);\n\n    if (!queryObj || queryObj && !Object.keys(queryObj).length) {\n      queryObj = {\n        match_all: {}\n      };\n    }\n\n    var currentQuery = _extends({\n      query: _extends({}, queryObj)\n    }, options);\n\n    if ((0, _helper.isEqual)(queryLog[component], currentQuery)) return;\n    dispatch((0, _misc.logQuery)(component, currentQuery));\n\n    if (store.config && store.config.enableAppbase) {\n      var appbaseQuery = {};\n      var componentProps = store.props[component] || {};\n      var compositeAggregationField = componentProps.aggregationField;\n      var queryType = _transform.componentToTypeMap[componentProps.componentType];\n\n      if (queryType === _constants.queryTypes.term) {\n        compositeAggregationField = componentProps.dataField;\n      }\n\n      var query = (0, _transform.getRSQuery)(component, (0, _transform.extractPropsFromState)(store, component, {\n        from: options.from,\n        after: store.aggregations[component] && store.aggregations[component][compositeAggregationField] && store.aggregations[component][compositeAggregationField].after_key || undefined\n      }));\n      appbaseQuery = _extends(_defineProperty({}, component, query), (0, _transform.getDependentQueries)(getState(), component, []));\n      var finalQuery = Object.keys(appbaseQuery).map(function (c) {\n        return appbaseQuery[c];\n      });\n      dispatch(appbaseSearch({\n        query: finalQuery,\n        orderOfQueries: [component],\n        appendToHits: appendToHits,\n        appendToAggs: appendToAggs\n      }));\n    } else {\n      var _finalQuery = [{\n        preference: component\n      }, currentQuery];\n      dispatch(msearch(_finalQuery, [component], appendToHits, false, appendToAggs));\n    }\n  };\n}","map":{"version":3,"sources":["/home/ma/soulmed-healthcare/soulmed/node_modules/@appbaseio/reactivecore/lib/actions/query.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","loadPopularSuggestions","executeQuery","setQueryOptions","updateQuery","loadMore","_value","require","_utils","_misc","_helper","_analytics","_analytics2","_interopRequireDefault","_maps","_graphQL","_graphQL2","_constants","_transform","_transform2","obj","__esModule","default","_defineProperty","enumerable","configurable","writable","_toConsumableArray","arr","Array","isArray","arr2","from","componentId","dispatch","getState","_getState","config","appbaseRef","props","internalValues","isAppbaseEnabled","enableAppbase","componentProps","internalValue","enablePopularSuggestions","enableQuerySuggestions","suggQuery","getSuggestionQuery","getQuerySuggestions","then","suggestions","querySuggestion","getQuerySuggestionsId","setPopularSuggestions","hits","split","setDefaultPopularSuggestions","catch","e","handleError","orderOfQueries","error","msearch","query","appendToHits","undefined","isInternalComponent","appendToAggs","componentType","_getState2","headers","analytics","selectedValues","searchHeaders","suggestionsComponents","componentTypes","dataSearch","categorySearch","isSuggestionsQuery","indexOf","analyticsConfig","suggestionAnalytics","suggestionsSearchValue","shouldIncludeQuery","emptyQuery","searchValue","searchId","filterString","_shouldIncludeQuery","searchStateHeader","searchState","getSearchState","keys","JSON","stringify","userId","customEvents","parseCustomEvents","forEach","component","setLoading","setError","graphQLUrl","url","credentials","app","res","handleResponseMSearch","err","setHeaders","type","body","appbaseSearch","_ref","_ref$appendToHits","_ref$isSuggestionsQue","searchComponentID","_ref$appendToAggs","_getState3","isAnalyticsEnabled","isPropertyDefined","recordAnalytics","settings","enableQueryRules","reactiveSearchv3","handleResponse","requestStack","lock","executeWatchList","mustExecuteMapQuery","metaOptions","_getState4","queryLog","mapData","watchMan","dependencyTree","queryList","queryOptions","queryListener","lockTime","initialQueriesSyncTime","initialTimestamp","componentList","finalQuery","appbaseQuery","watchList","concat","matchAllQuery","match_all","reference","reactiveList","reactiveMap","includes","setValue","_buildQuery","buildQuery","queryObj","options","validOptions","some","item","currentQuery","queryToLog","oldQuery","isEqual","logQuery","isMapComponent","existingQuery","bool","must","persistMapQuery","updateMapData","_getState5","combinedLog","logCombinedQuery","executeQueryListener","endsWith","mainComponentProps","isSearchComponent","getRSQuery","extractPropsFromState","getDependentQueries","internalComponent","getInternalComponentID","internalQuery","execute","preference","map","currentTime","Date","getTime","setTimeout","finalOrderOfQueries","finalIsSuggestionsQuery","finalSearchComponentID","orderOfQueriesMap","processedQueriesMap","queryExecutionMap","request","id","newQuery","finalCombinedQuery","values","push","updateQueryOptions","_ref2","_ref2$label","label","_ref2$showFilter","showFilter","_ref2$URLParams","URLParams","_ref2$componentType","_ref2$category","category","_ref2$meta","meta","queryToDispatch","dynamicRangeSlider","setInternalValue","getHistogramComponentID","setQuery","newOptions","store","_buildQuery2","compositeAggregationField","aggregationField","queryType","componentToTypeMap","queryTypes","term","dataField","after","aggregations","after_key","c","_finalQuery"],"mappings":"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","sourcesContent":["Object.defineProperty(exports,\"__esModule\",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.loadPopularSuggestions=loadPopularSuggestions;exports.executeQuery=executeQuery;exports.setQueryOptions=setQueryOptions;exports.updateQuery=updateQuery;exports.loadMore=loadMore;var _value=require('./value');var _utils=require('./utils');var _misc=require('./misc');var _helper=require('../utils/helper');var _analytics=require('../utils/analytics');var _analytics2=_interopRequireDefault(_analytics);var _maps=require('./maps');var _graphQL=require('../utils/graphQL');var _graphQL2=_interopRequireDefault(_graphQL);var _constants=require('../utils/constants');var _transform=require('../utils/transform');var _transform2=require('../../lib/utils/transform');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function loadPopularSuggestions(componentId){return function(dispatch,getState){var _getState=getState(),config=_getState.config,appbaseRef=_getState.appbaseRef,props=_getState.props,internalValues=_getState.internalValues;var isAppbaseEnabled=config&&config.enableAppbase;var componentProps=props[componentId]||{};var internalValue=internalValues[componentId];var value=internalValue&&internalValue.value||'';if(isAppbaseEnabled&&(componentProps.enablePopularSuggestions||componentProps.enableQuerySuggestions)){var suggQuery=(0,_utils.getSuggestionQuery)(getState,componentId);appbaseRef.getQuerySuggestions(suggQuery).then(function(suggestions){var querySuggestion=suggestions[(0,_utils.getQuerySuggestionsId)(componentId)];if(value){dispatch((0,_misc.setPopularSuggestions)(querySuggestion&&querySuggestion.hits&&querySuggestion.hits.hits,componentId.split('__internal')[0]));}else{dispatch((0,_misc.setDefaultPopularSuggestions)(querySuggestion&&querySuggestion.hits&&querySuggestion.hits.hits,componentId.split('__internal')[0]));}}).catch(function(e){(0,_utils.handleError)({orderOfQueries:[componentId],error:e},getState,dispatch);});}};}function msearch(query,orderOfQueries){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isInternalComponent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var appendToAggs=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var componentType=arguments[5];return function(dispatch,getState){var _getState2=getState(),appbaseRef=_getState2.appbaseRef,config=_getState2.config,headers=_getState2.headers,analytics=_getState2.analytics,selectedValues=_getState2.selectedValues;var searchHeaders={};var suggestionsComponents=[_constants.componentTypes.dataSearch,_constants.componentTypes.categorySearch];var isSuggestionsQuery=isInternalComponent&&suggestionsComponents.indexOf(componentType)!==-1;if(config.analytics){if(config.analyticsConfig.suggestionAnalytics&&isSuggestionsQuery){var suggestionsSearchValue=analytics.suggestionsSearchValue;var shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||suggestionsSearchValue);if(shouldIncludeQuery){searchHeaders={'X-Search-Query':suggestionsSearchValue||''};}}else{var searchValue=analytics.searchValue,searchId=analytics.searchId;var filterString=(0,_analytics2.default)(selectedValues);if(searchId){searchHeaders=_extends({'X-Search-Id':searchId,'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}else{var _shouldIncludeQuery=!!(config.analyticsConfig.emptyQuery||searchValue);searchHeaders=_extends(_shouldIncludeQuery&&{'X-Search-Query':searchValue||''},filterString&&{'X-Search-Filters':filterString});}}if(config.analyticsConfig.searchStateHeader){var searchState=(0,_helper.getSearchState)(getState(),true);if(searchState&&Object.keys(searchState).length){searchHeaders['X-Search-State']=JSON.stringify(searchState);}}if(config.analyticsConfig.userId){searchHeaders['X-User-Id']=config.analyticsConfig.userId;}if(config.analyticsConfig.customEvents){searchHeaders['X-Search-CustomEvent']=(0,_analytics.parseCustomEvents)(config.analyticsConfig.customEvents);}}orderOfQueries.forEach(function(component){dispatch((0,_misc.setLoading)(component,true));dispatch((0,_misc.setError)(component,null));});if(config.graphQLUrl){(0,_graphQL2.default)(config.graphQLUrl,config.url,config.credentials,config.app,query).then(function(res){(0,_utils.handleResponseMSearch)({res:res,isSuggestionsQuery:isSuggestionsQuery,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}else{appbaseRef.setHeaders(_extends({},headers,searchHeaders));appbaseRef.msearch({type:config.type==='*'?'':config.type,body:query}).then(function(res){(0,_utils.handleResponseMSearch)({res:res,isSuggestionsQuery:isSuggestionsQuery,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});}};}function appbaseSearch(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},query=_ref.query,orderOfQueries=_ref.orderOfQueries,_ref$appendToHits=_ref.appendToHits,appendToHits=_ref$appendToHits===undefined?false:_ref$appendToHits,_ref$isSuggestionsQue=_ref.isSuggestionsQuery,isSuggestionsQuery=_ref$isSuggestionsQue===undefined?false:_ref$isSuggestionsQue,searchComponentID=_ref.searchComponentID,_ref$appendToAggs=_ref.appendToAggs,appendToAggs=_ref$appendToAggs===undefined?false:_ref$appendToAggs;return function(dispatch,getState){var _getState3=getState(),appbaseRef=_getState3.appbaseRef,config=_getState3.config,headers=_getState3.headers;var isAnalyticsEnabled=false;if(config){if((0,_utils.isPropertyDefined)(config.analytics)){isAnalyticsEnabled=config.analytics;}else if(config.analyticsConfig){if((0,_utils.isPropertyDefined)(config.analyticsConfig.recordAnalytics)){isAnalyticsEnabled=config.analyticsConfig.recordAnalytics;}else if((0,_utils.isPropertyDefined)(config.analyticsConfig.analytics)){isAnalyticsEnabled=config.analyticsConfig.analytics;}}}var settings={recordAnalytics:isAnalyticsEnabled};if(config.analyticsConfig){settings.userId=(0,_utils.isPropertyDefined)(config.analyticsConfig.userId)?config.analyticsConfig.userId:undefined;settings.enableQueryRules=(0,_utils.isPropertyDefined)(config.analyticsConfig.enableQueryRules)?config.analyticsConfig.enableQueryRules:undefined;settings.customEvents=(0,_utils.isPropertyDefined)(config.analyticsConfig.customEvents)?config.analyticsConfig.customEvents:undefined;}orderOfQueries.forEach(function(component){dispatch((0,_misc.setLoading)(component,true));dispatch((0,_misc.setError)(component,null));});appbaseRef.setHeaders(_extends({},headers));if(isSuggestionsQuery&&searchComponentID){dispatch(loadPopularSuggestions(searchComponentID));}appbaseRef.reactiveSearchv3(query,settings).then(function(res){(0,_utils.handleResponse)({res:res,orderOfQueries:orderOfQueries,appendToHits:appendToHits,appendToAggs:appendToAggs},getState,dispatch);}).catch(function(err){(0,_utils.handleError)({orderOfQueries:orderOfQueries,error:err},getState,dispatch);});};}var requestStack=[];var lock=false;function executeQuery(componentId){var executeWatchList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var mustExecuteMapQuery=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var componentType=arguments[3];var metaOptions=arguments[4];return function(dispatch,getState){var _getState4=getState(),queryLog=_getState4.queryLog,config=_getState4.config,mapData=_getState4.mapData,watchMan=_getState4.watchMan,dependencyTree=_getState4.dependencyTree,queryList=_getState4.queryList,queryOptions=_getState4.queryOptions,queryListener=_getState4.queryListener,props=_getState4.props,selectedValues=_getState4.selectedValues,internalValues=_getState4.internalValues;var lockTime=config.initialQueriesSyncTime;var initialTimestamp=config.initialTimestamp;var componentList=[componentId];var finalQuery=[];var appbaseQuery={};var orderOfQueries=[];var isAppbaseEnabled=config&&config.enableAppbase;if(executeWatchList){var watchList=watchMan[componentId]||[];componentList=[].concat(_toConsumableArray(componentList),_toConsumableArray(watchList));}var matchAllQuery={match_all:{}};componentList.forEach(function(component){var componentProps=props[component];if(selectedValues[componentId]&&selectedValues[componentId].reference!=='URL'&&[_constants.componentTypes.reactiveList,_constants.componentTypes.reactiveMap].includes(componentProps.componentType)){dispatch((0,_value.setValue)(component,null));}var _buildQuery=(0,_helper.buildQuery)(component,dependencyTree,queryList,queryOptions),queryObj=_buildQuery.queryObj,options=_buildQuery.options;var validOptions=['aggs','from','sort'];if(queryObj&&!!Object.keys(queryObj).length||options&&Object.keys(options).some(function(item){return validOptions.includes(item);})){if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj=_extends({},matchAllQuery);}var currentQuery=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var queryToLog=_extends({query:_extends({},queryObj)},options,queryOptions[component]);var oldQuery=queryLog[component];if(mustExecuteMapQuery||!(0,_helper.isEqual)(currentQuery,oldQuery)){orderOfQueries=[].concat(_toConsumableArray(orderOfQueries),[component]);dispatch((0,_misc.logQuery)(component,queryToLog));var isMapComponent=Object.keys(mapData).includes(component);if(isMapComponent&&mapData[component].query){var existingQuery=currentQuery.query;currentQuery.query={bool:{must:[existingQuery,mapData[component].query]}};if(!mapData[component].persistMapQuery){dispatch((0,_maps.updateMapData)(componentId,null,false));}var _getState5=getState(),combinedLog=_getState5.combinedLog;if((0,_helper.isEqual)(combinedLog[component],currentQuery))return;dispatch((0,_misc.logCombinedQuery)(component,currentQuery));}(0,_utils.executeQueryListener)(queryListener[component],oldQuery,currentQuery);if(isAppbaseEnabled){var value=void 0;var isInternalComponent=componentId.endsWith('__internal');var mainComponentProps=props[componentId];if(isInternalComponent&&(0,_transform.isSearchComponent)(mainComponentProps.componentType)){value=internalValues[componentId]&&internalValues[componentId].value;}var query=(0,_transform.getRSQuery)(component,(0,_transform.extractPropsFromState)(getState(),component,_extends({},value?{value:value}:null,metaOptions?{from:metaOptions.from}:null)));if(query){appbaseQuery=_extends({},appbaseQuery,_defineProperty({},component,query),(0,_transform.getDependentQueries)(getState(),component,orderOfQueries));}if(isMapComponent){var internalComponent=(0,_transform2.getInternalComponentID)(component);var internalQuery=(0,_transform.getRSQuery)(internalComponent,(0,_transform.extractPropsFromState)(getState(),internalComponent,metaOptions?{from:metaOptions.from}:null));if(internalQuery){appbaseQuery[internalComponent]=_extends({},internalQuery,{execute:false});}}}else{finalQuery=[].concat(_toConsumableArray(finalQuery),[{preference:component},currentQuery]);}}}});if(isAppbaseEnabled){finalQuery=Object.keys(appbaseQuery).map(function(component){return appbaseQuery[component];});}if(finalQuery.length){if(isAppbaseEnabled){var suggestionsComponents=[_constants.componentTypes.dataSearch,_constants.componentTypes.categorySearch];var isInternalComponent=componentId.endsWith('__internal');var isSuggestionsQuery=isInternalComponent&&suggestionsComponents.indexOf(componentType)!==-1;var currentTime=new Date().getTime();if(currentTime-initialTimestamp<lockTime){if(!lock){setTimeout(function(){var finalOrderOfQueries=[];var finalIsSuggestionsQuery=false;var finalSearchComponentID='';var orderOfQueriesMap={};var processedQueriesMap={};var queryExecutionMap={};requestStack.forEach(function(request){if(!finalIsSuggestionsQuery){finalIsSuggestionsQuery=request.isSuggestionsQuery;}if(!finalSearchComponentID){finalSearchComponentID=request.searchComponentID;}if(Array.isArray(request.query)){request.query.forEach(function(query){if(query.execute){queryExecutionMap[query.id]=query.execute;}var newQuery=query;if(queryExecutionMap[query.id]){newQuery.execute=true;}processedQueriesMap[query.id]=newQuery;});}if(Array.isArray(request.orderOfQueries)){request.orderOfQueries.forEach(function(query){if(!orderOfQueriesMap[query.id]){finalOrderOfQueries=[query].concat(_toConsumableArray(finalOrderOfQueries));}else{orderOfQueriesMap[query.id]=true;}});}});var finalCombinedQuery=Object.values(processedQueriesMap);if(finalCombinedQuery.length){dispatch(appbaseSearch({query:finalCombinedQuery,orderOfQueries:finalOrderOfQueries,isSuggestionsQuery:finalIsSuggestionsQuery,searchComponentID:finalSearchComponentID}));}requestStack=[];},lockTime);}lock=true;requestStack.push({query:finalQuery,orderOfQueries:orderOfQueries,isSuggestionsQuery:isSuggestionsQuery,searchComponentID:componentId});}else{dispatch(appbaseSearch({query:finalQuery,orderOfQueries:orderOfQueries,isSuggestionsQuery:isSuggestionsQuery,searchComponentID:componentId}));}}else{dispatch(msearch(finalQuery,orderOfQueries,false,componentId.endsWith('__internal'),undefined,componentType));}}};}function setQueryOptions(component,queryOptions){var execute=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return function(dispatch){dispatch((0,_misc.updateQueryOptions)(component,queryOptions));if(execute){dispatch(executeQuery(component,true));}};}function updateQuery(_ref2){var componentId=_ref2.componentId,query=_ref2.query,value=_ref2.value,_ref2$label=_ref2.label,label=_ref2$label===undefined?null:_ref2$label,_ref2$showFilter=_ref2.showFilter,showFilter=_ref2$showFilter===undefined?true:_ref2$showFilter,_ref2$URLParams=_ref2.URLParams,URLParams=_ref2$URLParams===undefined?false:_ref2$URLParams,_ref2$componentType=_ref2.componentType,componentType=_ref2$componentType===undefined?null:_ref2$componentType,_ref2$category=_ref2.category,category=_ref2$category===undefined?null:_ref2$category,_ref2$meta=_ref2.meta,meta=_ref2$meta===undefined?{}:_ref2$meta;var execute=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return function(dispatch){var queryToDispatch=query;if(query&&query.query){queryToDispatch=query.query;}if(!componentId.endsWith('__internal')){dispatch((0,_value.setValue)(componentId,value,label,showFilter,URLParams,componentType,category,meta));if(componentType===_constants.componentTypes.dynamicRangeSlider){dispatch((0,_value.setInternalValue)((0,_transform.getHistogramComponentID)(componentId),value,componentType,category,meta));}else{dispatch((0,_value.setInternalValue)(componentId+'__internal',value,componentType,category,meta));}}else{dispatch((0,_value.setInternalValue)(componentId,value,componentType,category,meta));}dispatch((0,_misc.setQuery)(componentId,queryToDispatch));if(execute)dispatch(executeQuery(componentId,true,false,componentType));};}function loadMore(component,newOptions){var appendToHits=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var appendToAggs=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;return function(dispatch,getState){var store=getState();var _buildQuery2=(0,_helper.buildQuery)(component,store.dependencyTree,store.queryList,store.queryOptions),queryObj=_buildQuery2.queryObj,options=_buildQuery2.options;var queryLog=store.queryLog;if(!options)options={};options=_extends({},options,newOptions);if(!queryObj||queryObj&&!Object.keys(queryObj).length){queryObj={match_all:{}};}var currentQuery=_extends({query:_extends({},queryObj)},options);if((0,_helper.isEqual)(queryLog[component],currentQuery))return;dispatch((0,_misc.logQuery)(component,currentQuery));if(store.config&&store.config.enableAppbase){var appbaseQuery={};var componentProps=store.props[component]||{};var compositeAggregationField=componentProps.aggregationField;var queryType=_transform.componentToTypeMap[componentProps.componentType];if(queryType===_constants.queryTypes.term){compositeAggregationField=componentProps.dataField;}var query=(0,_transform.getRSQuery)(component,(0,_transform.extractPropsFromState)(store,component,{from:options.from,after:store.aggregations[component]&&store.aggregations[component][compositeAggregationField]&&store.aggregations[component][compositeAggregationField].after_key||undefined}));appbaseQuery=_extends(_defineProperty({},component,query),(0,_transform.getDependentQueries)(getState(),component,[]));var finalQuery=Object.keys(appbaseQuery).map(function(c){return appbaseQuery[c];});dispatch(appbaseSearch({query:finalQuery,orderOfQueries:[component],appendToHits:appendToHits,appendToAggs:appendToAggs}));}else{var _finalQuery=[{preference:component},currentQuery];dispatch(msearch(_finalQuery,[component],appendToHits,false,appendToAggs));}};}"]},"metadata":{},"sourceType":"script"}