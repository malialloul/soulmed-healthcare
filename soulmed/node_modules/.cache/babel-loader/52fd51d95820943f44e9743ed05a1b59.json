{"ast":null,"code":"function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nimport { defaults, debounce, getPath, setPath, pushPath } from './utils.js';\nimport { readFile, readFileSync } from './readFile.js';\nimport { writeFile as _writeFile, removeFile as _removeFile } from './writeFile.js';\n\nvar getDefaults = function getDefaults() {\n  return {\n    loadPath: '/locales/{{lng}}/{{ns}}.json',\n    addPath: '/locales/{{lng}}/{{ns}}.missing.json',\n    ident: 2,\n    parse: JSON.parse,\n    stringify: JSON.stringify\n  };\n};\n\nvar Backend = function () {\n  function Backend(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    _classCallCheck(this, Backend);\n\n    this.services = services;\n    this.options = options;\n    this.allOptions = allOptions;\n    this.type = 'backend';\n    this.init(services, options, allOptions);\n  }\n\n  _createClass(Backend, [{\n    key: \"init\",\n    value: function init(services) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      this.services = services;\n      this.options = defaults(options, this.options || {}, getDefaults());\n      this.allOptions = allOptions;\n      this.queuedWrites = {};\n      this.debouncedWrite = debounce(this.write, 250);\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      var _this = this;\n\n      var loadPath = this.options.loadPath;\n\n      if (typeof this.options.loadPath === 'function') {\n        loadPath = this.options.loadPath(language, namespace);\n      }\n\n      var filename = this.services.interpolator.interpolate(loadPath, {\n        lng: language,\n        ns: namespace\n      });\n\n      if (this.allOptions.initImmediate === false) {\n        try {\n          var _readFileSync = readFileSync(filename, this.options),\n              data = _readFileSync.data,\n              stat = _readFileSync.stat;\n\n          if (this.options.expirationTime && stat && stat.mtime && stat.mtime.getTime() + this.options.expirationTime < Date.now()) {\n            this.removeFile(language, namespace);\n            return callback(new Error('File expired!'), false);\n          }\n\n          callback(null, data);\n        } catch (err) {\n          callback(err, false);\n        }\n\n        return;\n      }\n\n      readFile(filename, this.options).then(function (_ref) {\n        var data = _ref.data,\n            stat = _ref.stat;\n\n        if (_this.options.expirationTime && stat && stat.mtime && stat.mtime.getTime() + _this.options.expirationTime < Date.now()) {\n          _this.removeFile(language, namespace);\n\n          return callback(new Error('File expired!'), false);\n        }\n\n        callback(null, data);\n      }).catch(function (err) {\n        return callback(err, false);\n      });\n    }\n  }, {\n    key: \"create\",\n    value: function create(languages, namespace, key, fallbackValue, callback) {\n      var _this2 = this;\n\n      if (!callback) callback = function callback() {};\n      if (typeof languages === 'string') languages = [languages];\n      var todo = languages.length;\n\n      var done = function done() {\n        if (! --todo) callback();\n      };\n\n      languages.forEach(function (lng) {\n        _this2.queue.call(_this2, lng, namespace, key, fallbackValue, done);\n      });\n    }\n  }, {\n    key: \"save\",\n    value: function save(language, namespace, data, callback) {\n      var _this3 = this;\n\n      if (!callback) callback = function callback() {};\n      var keys = Object.keys(data);\n      var todo = keys.length;\n\n      var done = function done() {\n        if (! --todo) callback();\n      };\n\n      keys.forEach(function (key) {\n        _this3.queue.call(_this3, language, namespace, key, data[key], done);\n      });\n    }\n  }, {\n    key: \"removeFile\",\n    value: function removeFile(language, namespace) {\n      var addPath = this.options.addPath;\n\n      if (typeof this.options.addPath === 'function') {\n        addPath = this.options.addPath(language, namespace);\n      }\n\n      var filename = this.services.interpolator.interpolate(addPath, {\n        lng: language,\n        ns: namespace\n      });\n\n      _removeFile(filename, this.options).then(function () {}).catch(function () {});\n    }\n  }, {\n    key: \"write\",\n    value: function write() {\n      for (var lng in this.queuedWrites) {\n        var namespaces = this.queuedWrites[lng];\n\n        if (lng !== 'locks') {\n          for (var ns in namespaces) {\n            this.writeFile(lng, ns);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"writeFile\",\n    value: function writeFile(lng, namespace) {\n      var _this4 = this;\n\n      var lock = getPath(this.queuedWrites, ['locks', lng, namespace]);\n      if (lock) return;\n      var addPath = this.options.addPath;\n\n      if (typeof this.options.addPath === 'function') {\n        addPath = this.options.addPath(lng, namespace);\n      }\n\n      var filename = this.services.interpolator.interpolate(addPath, {\n        lng: lng,\n        ns: namespace\n      });\n      var missings = getPath(this.queuedWrites, [lng, namespace]);\n      setPath(this.queuedWrites, [lng, namespace], []);\n\n      if (missings.length) {\n        setPath(this.queuedWrites, ['locks', lng, namespace], true);\n\n        var proceed = function proceed(_ref2) {\n          var data = _ref2.data;\n          missings.forEach(function (missing) {\n            var path = _this4.allOptions.keySeparator === false ? [missing.key] : missing.key.split(_this4.allOptions.keySeparator || '.');\n            setPath(data, path, missing.fallbackValue);\n          });\n\n          var proceedWrite = function proceedWrite() {\n            setPath(_this4.queuedWrites, ['locks', lng, namespace], false);\n            missings.forEach(function (missing) {\n              if (missing.callback) missing.callback();\n            });\n\n            _this4.debouncedWrite();\n          };\n\n          _writeFile(filename, data, _this4.options).then(proceedWrite).catch(proceedWrite);\n        };\n\n        readFile(filename, this.options).then(proceed).catch(function () {\n          return proceed({\n            data: {}\n          });\n        });\n      }\n    }\n  }, {\n    key: \"queue\",\n    value: function queue(lng, namespace, key, fallbackValue, callback) {\n      pushPath(this.queuedWrites, [lng, namespace], {\n        key: key,\n        fallbackValue: fallbackValue || '',\n        callback: callback\n      });\n      this.debouncedWrite();\n    }\n  }]);\n\n  return Backend;\n}();\n\nBackend.type = 'backend';\nexport default Backend;","map":{"version":3,"sources":["/home/ma/soulmed-healthcare/node_modules/i18next-fs-backend/esm/index.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","defaults","debounce","getPath","setPath","pushPath","readFile","readFileSync","writeFile","_writeFile","removeFile","_removeFile","getDefaults","loadPath","addPath","ident","parse","JSON","stringify","Backend","services","options","arguments","undefined","allOptions","type","init","value","queuedWrites","debouncedWrite","write","read","language","namespace","callback","_this","filename","interpolator","interpolate","lng","ns","initImmediate","_readFileSync","data","stat","expirationTime","mtime","getTime","Date","now","Error","err","then","_ref","catch","create","languages","fallbackValue","_this2","todo","done","forEach","queue","call","save","_this3","keys","namespaces","_this4","lock","missings","proceed","_ref2","missing","path","keySeparator","split","proceedWrite"],"mappings":"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","sourcesContent":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nimport { defaults, debounce, getPath, setPath, pushPath } from './utils.js';\nimport { readFile, readFileSync } from './readFile.js';\nimport { writeFile as _writeFile, removeFile as _removeFile } from './writeFile.js';\n\nvar getDefaults = function getDefaults() {\n  return {\n    loadPath: '/locales/{{lng}}/{{ns}}.json',\n    addPath: '/locales/{{lng}}/{{ns}}.missing.json',\n    ident: 2,\n    parse: JSON.parse,\n    stringify: JSON.stringify\n  };\n};\n\nvar Backend = function () {\n  function Backend(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    _classCallCheck(this, Backend);\n\n    this.services = services;\n    this.options = options;\n    this.allOptions = allOptions;\n    this.type = 'backend';\n    this.init(services, options, allOptions);\n  }\n\n  _createClass(Backend, [{\n    key: \"init\",\n    value: function init(services) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      this.services = services;\n      this.options = defaults(options, this.options || {}, getDefaults());\n      this.allOptions = allOptions;\n      this.queuedWrites = {};\n      this.debouncedWrite = debounce(this.write, 250);\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      var _this = this;\n\n      var loadPath = this.options.loadPath;\n\n      if (typeof this.options.loadPath === 'function') {\n        loadPath = this.options.loadPath(language, namespace);\n      }\n\n      var filename = this.services.interpolator.interpolate(loadPath, {\n        lng: language,\n        ns: namespace\n      });\n\n      if (this.allOptions.initImmediate === false) {\n        try {\n          var _readFileSync = readFileSync(filename, this.options),\n              data = _readFileSync.data,\n              stat = _readFileSync.stat;\n\n          if (this.options.expirationTime && stat && stat.mtime && stat.mtime.getTime() + this.options.expirationTime < Date.now()) {\n            this.removeFile(language, namespace);\n            return callback(new Error('File expired!'), false);\n          }\n\n          callback(null, data);\n        } catch (err) {\n          callback(err, false);\n        }\n\n        return;\n      }\n\n      readFile(filename, this.options).then(function (_ref) {\n        var data = _ref.data,\n            stat = _ref.stat;\n\n        if (_this.options.expirationTime && stat && stat.mtime && stat.mtime.getTime() + _this.options.expirationTime < Date.now()) {\n          _this.removeFile(language, namespace);\n\n          return callback(new Error('File expired!'), false);\n        }\n\n        callback(null, data);\n      }).catch(function (err) {\n        return callback(err, false);\n      });\n    }\n  }, {\n    key: \"create\",\n    value: function create(languages, namespace, key, fallbackValue, callback) {\n      var _this2 = this;\n\n      if (!callback) callback = function callback() {};\n      if (typeof languages === 'string') languages = [languages];\n      var todo = languages.length;\n\n      var done = function done() {\n        if (! --todo) callback();\n      };\n\n      languages.forEach(function (lng) {\n        _this2.queue.call(_this2, lng, namespace, key, fallbackValue, done);\n      });\n    }\n  }, {\n    key: \"save\",\n    value: function save(language, namespace, data, callback) {\n      var _this3 = this;\n\n      if (!callback) callback = function callback() {};\n      var keys = Object.keys(data);\n      var todo = keys.length;\n\n      var done = function done() {\n        if (! --todo) callback();\n      };\n\n      keys.forEach(function (key) {\n        _this3.queue.call(_this3, language, namespace, key, data[key], done);\n      });\n    }\n  }, {\n    key: \"removeFile\",\n    value: function removeFile(language, namespace) {\n      var addPath = this.options.addPath;\n\n      if (typeof this.options.addPath === 'function') {\n        addPath = this.options.addPath(language, namespace);\n      }\n\n      var filename = this.services.interpolator.interpolate(addPath, {\n        lng: language,\n        ns: namespace\n      });\n\n      _removeFile(filename, this.options).then(function () {}).catch(function () {});\n    }\n  }, {\n    key: \"write\",\n    value: function write() {\n      for (var lng in this.queuedWrites) {\n        var namespaces = this.queuedWrites[lng];\n\n        if (lng !== 'locks') {\n          for (var ns in namespaces) {\n            this.writeFile(lng, ns);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"writeFile\",\n    value: function writeFile(lng, namespace) {\n      var _this4 = this;\n\n      var lock = getPath(this.queuedWrites, ['locks', lng, namespace]);\n      if (lock) return;\n      var addPath = this.options.addPath;\n\n      if (typeof this.options.addPath === 'function') {\n        addPath = this.options.addPath(lng, namespace);\n      }\n\n      var filename = this.services.interpolator.interpolate(addPath, {\n        lng: lng,\n        ns: namespace\n      });\n      var missings = getPath(this.queuedWrites, [lng, namespace]);\n      setPath(this.queuedWrites, [lng, namespace], []);\n\n      if (missings.length) {\n        setPath(this.queuedWrites, ['locks', lng, namespace], true);\n\n        var proceed = function proceed(_ref2) {\n          var data = _ref2.data;\n          missings.forEach(function (missing) {\n            var path = _this4.allOptions.keySeparator === false ? [missing.key] : missing.key.split(_this4.allOptions.keySeparator || '.');\n            setPath(data, path, missing.fallbackValue);\n          });\n\n          var proceedWrite = function proceedWrite() {\n            setPath(_this4.queuedWrites, ['locks', lng, namespace], false);\n            missings.forEach(function (missing) {\n              if (missing.callback) missing.callback();\n            });\n\n            _this4.debouncedWrite();\n          };\n\n          _writeFile(filename, data, _this4.options).then(proceedWrite).catch(proceedWrite);\n        };\n\n        readFile(filename, this.options).then(proceed).catch(function () {\n          return proceed({\n            data: {}\n          });\n        });\n      }\n    }\n  }, {\n    key: \"queue\",\n    value: function queue(lng, namespace, key, fallbackValue, callback) {\n      pushPath(this.queuedWrites, [lng, namespace], {\n        key: key,\n        fallbackValue: fallbackValue || '',\n        callback: callback\n      });\n      this.debouncedWrite();\n    }\n  }]);\n\n  return Backend;\n}();\n\nBackend.type = 'backend';\nexport default Backend;"]},"metadata":{},"sourceType":"module"}