{"ast":null,"code":"import URL from 'url-parser-lite';\nimport querystring from 'querystring';\nimport fetch from 'cross-fetch';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction contains(string, substring) {\n  return string.indexOf(substring) !== -1;\n}\n\nfunction isAppbase(url) {\n  return contains(url, 'scalr.api.appbase.io');\n}\n\nfunction btoa() {\n  var input = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  var str = input;\n  var output = ''; // eslint-disable-next-line\n\n  for (var block = 0, charCode, i = 0, map = chars; str.charAt(i | 0) || (map = '=', i % 1); // eslint-disable-line no-bitwise\n  output += map.charAt(63 & block >> 8 - i % 1 * 8) // eslint-disable-line no-bitwise\n  ) {\n    charCode = str.charCodeAt(i += 3 / 4);\n\n    if (charCode > 0xff) {\n      throw new Error('\"btoa\" failed: The string to be encoded contains characters outside of the Latin1 range.');\n    }\n\n    block = block << 8 | charCode; // eslint-disable-line no-bitwise\n  }\n\n  return output;\n}\n\nfunction validateRSQuery(query) {\n  if (query && Object.prototype.toString.call(query) === '[object Array]') {\n    for (var i = 0; i < query.length; i += 1) {\n      var q = query[i];\n\n      if (q) {\n        if (!q.id) {\n          return new Error(\"'id' field must be present in query object\");\n        }\n      } else {\n        return new Error('query object can not have an empty value');\n      }\n    }\n\n    return true;\n  }\n\n  return new Error(\"invalid query value, 'query' value must be an array\");\n}\n\nfunction validate(object, fields) {\n  var invalid = [];\n  var emptyFor = {\n    object: null,\n    string: '',\n    number: 0\n  };\n  var keys = Object.keys(fields);\n  keys.forEach(function (key) {\n    var types = fields[key].split('|');\n    var matchedType = types.find(function (type) {\n      return (// eslint-disable-next-line\n        _typeof(object[key]) === type\n      );\n    });\n\n    if (!matchedType || object[key] === emptyFor[matchedType]) {\n      invalid.push(key);\n    }\n  });\n  var missing = '';\n\n  for (var i = 0; i < invalid.length; i += 1) {\n    missing += invalid[i] + ', ';\n  }\n\n  if (invalid.length > 0) {\n    return new Error('fields missing: ' + missing);\n  }\n\n  return true;\n}\n\nfunction removeUndefined() {\n  var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (value || !(Object.keys(value).length === 0 && value.constructor === Object)) {\n    return JSON.parse(JSON.stringify(value));\n  }\n\n  return null;\n}\n\nfunction encodeHeaders() {\n  var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var shouldEncode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true; // Encode headers\n\n  var encodedHeaders = {};\n\n  if (shouldEncode) {\n    Object.keys(headers).forEach(function (header) {\n      encodedHeaders[header] = encodeURI(headers[header]);\n    });\n  } else {\n    encodedHeaders = headers;\n  }\n\n  return encodedHeaders;\n}\n\nfunction getTelemetryHeaders(enableTelemetry) {\n  var headers = {};\n  Object.assign(headers, {\n    'X-Search-Client': 'Appbase JS'\n  });\n\n  if (enableTelemetry === false) {\n    Object.assign(headers, {\n      'X-Enable-Telemetry': enableTelemetry\n    });\n  }\n\n  return headers;\n}\n/**\n * Returns an instance of Appbase client\n * @param {Object} config To configure properties\n * @param {String} config.url\n * @param {String} config.app\n * @param {String} config.credentials\n * @param {String} config.username\n * @param {String} config.password\n * @param {Boolean} config.enableTelemetry\n * A callback function which will be invoked before a fetch request made\n */\n\n\nfunction AppBase(config) {\n  var _URL = URL(config.url || ''),\n      _URL$auth = _URL.auth,\n      auth = _URL$auth === undefined ? null : _URL$auth,\n      _URL$host = _URL.host,\n      host = _URL$host === undefined ? '' : _URL$host,\n      _URL$path = _URL.path,\n      path = _URL$path === undefined ? '' : _URL$path,\n      _URL$protocol = _URL.protocol,\n      protocol = _URL$protocol === undefined ? '' : _URL$protocol;\n\n  var url = host + path; // Validate config and throw appropriate error\n\n  if (typeof url !== 'string' || url === '') {\n    throw new Error('URL not present in options.');\n  }\n\n  if (typeof config.app !== 'string' || config.app === '') {\n    throw new Error('App name is not present in options.');\n  }\n\n  if (typeof protocol !== 'string' || protocol === '') {\n    throw new Error('Protocol is not present in url. URL should be of the form https://appbase-demo-ansible-abxiydt-arc.searchbase.io');\n  } // Parse url\n\n\n  if (url.slice(-1) === '/') {\n    url = url.slice(0, -1);\n  }\n\n  var credentials = auth || null;\n  /**\n   * Credentials can be provided as a part of the URL,\n   * as username, password args or as a credentials argument directly */\n\n  if (typeof config.credentials === 'string' && config.credentials !== '') {\n    // eslint-disable-next-line\n    credentials = config.credentials;\n  } else if (typeof config.username === 'string' && config.username !== '' && typeof config.password === 'string' && config.password !== '') {\n    credentials = config.username + ':' + config.password;\n  }\n\n  if (isAppbase(url) && credentials === null) {\n    throw new Error('Authentication information is not present. Did you add credentials?');\n  }\n\n  this.url = url;\n  this.protocol = protocol;\n  this.app = config.app;\n  this.credentials = credentials;\n\n  if (typeof config.enableTelemetry === 'boolean') {\n    this.enableTelemetry = config.enableTelemetry;\n  }\n}\n/**\n * To perform fetch request\n * @param {Object} args\n * @param {String} args.method\n * @param {String} args.path\n * @param {Object} args.params\n * @param {Object} args.body\n * @param {Object} args.headers\n * @param {boolean} args.isSuggestionsAPI\n */\n\n\nfunction fetchRequest(args) {\n  var _this = this;\n\n  return new Promise(function (resolve, reject) {\n    var parsedArgs = removeUndefined(args);\n\n    try {\n      var method = parsedArgs.method,\n          path = parsedArgs.path,\n          params = parsedArgs.params,\n          body = parsedArgs.body,\n          isRSAPI = parsedArgs.isRSAPI,\n          isSuggestionsAPI = parsedArgs.isSuggestionsAPI;\n      var app = isSuggestionsAPI ? '.suggestions' : _this.app;\n      var bodyCopy = body;\n      var contentType = path.endsWith('msearch') || path.endsWith('bulk') ? 'application/x-ndjson' : 'application/json';\n      var headers = Object.assign({}, {\n        Accept: 'application/json',\n        'Content-Type': contentType\n      }, args.headers, _this.headers);\n      var timestamp = Date.now();\n\n      if (_this.credentials) {\n        headers.Authorization = 'Basic ' + btoa(_this.credentials);\n      }\n\n      var requestOptions = {\n        method: method,\n        headers: headers\n      };\n\n      if (Array.isArray(bodyCopy)) {\n        var arrayBody = '';\n        bodyCopy.forEach(function (item) {\n          arrayBody += JSON.stringify(item);\n          arrayBody += '\\n';\n        });\n        bodyCopy = arrayBody;\n      } else {\n        bodyCopy = JSON.stringify(bodyCopy) || {};\n      }\n\n      if (Object.keys(bodyCopy).length !== 0) {\n        requestOptions.body = bodyCopy;\n      }\n\n      var handleTransformRequest = function handleTransformRequest(res) {\n        if (_this.transformRequest && typeof _this.transformRequest === 'function') {\n          var tarnsformRequestPromise = _this.transformRequest(res);\n\n          return tarnsformRequestPromise instanceof Promise ? tarnsformRequestPromise : Promise.resolve(tarnsformRequestPromise);\n        }\n\n        return Promise.resolve(res);\n      };\n\n      var responseHeaders = {};\n      var paramsString = '';\n\n      if (params) {\n        paramsString = '?' + querystring.stringify(params);\n      }\n\n      var finalURL = _this.protocol + '://' + _this.url + '/' + app + '/' + path + paramsString;\n      return handleTransformRequest(Object.assign({}, {\n        url: finalURL\n      }, requestOptions)).then(function (ts) {\n        var transformedRequest = Object.assign({}, ts);\n        var url = transformedRequest.url;\n        delete transformedRequest.url;\n        return fetch(url || finalURL, Object.assign({}, transformedRequest, {\n          // apply timestamp header for RS API\n          headers: isRSAPI ? Object.assign({}, transformedRequest.headers, {\n            'x-timestamp': new Date().getTime()\n          }) : transformedRequest.headers\n        })).then(function (res) {\n          if (res.status >= 500) {\n            return reject(res);\n          }\n\n          responseHeaders = res.headers;\n          return res.json().then(function (data) {\n            if (res.status >= 400) {\n              return reject(res);\n            }\n\n            if (data && data.error) {\n              return reject(data);\n            } // Handle error from RS API RESPONSE\n\n\n            if (isRSAPI && data && Object.prototype.toString.call(data) === '[object Object]') {\n              if (body && body.query && body.query instanceof Array) {\n                var errorResponses = 0;\n                var allResponses = body.query.filter(function (q) {\n                  return q.execute || q.execute === undefined;\n                }).length;\n\n                if (data) {\n                  Object.keys(data).forEach(function (key) {\n                    if (data[key] && Object.prototype.hasOwnProperty.call(data[key], 'error')) {\n                      errorResponses += 1;\n                    }\n                  });\n                } // reject only when all responses has error\n\n\n                if (errorResponses > 0 && allResponses === errorResponses) {\n                  return reject(data);\n                }\n              }\n            } // Handle error from _msearch response\n\n\n            if (data && data.responses instanceof Array) {\n              var _allResponses = data.responses.length;\n              var _errorResponses = data.responses.filter(function (entry) {\n                return Object.prototype.hasOwnProperty.call(entry, 'error');\n              }).length; // reject only when all responses has error\n\n              if (_allResponses === _errorResponses) {\n                return reject(data);\n              }\n            }\n\n            var response = Object.assign({}, data, {\n              _timestamp: timestamp,\n              _headers: responseHeaders\n            });\n            return resolve(response);\n          }).catch(function (e) {\n            return reject(e);\n          });\n        }).catch(function (e) {\n          return reject(e);\n        });\n      }).catch(function (err) {\n        return reject(err);\n      });\n    } catch (e) {\n      return reject(e);\n    }\n  });\n}\n/**\n * Index Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {String} args.id\n */\n\n\nfunction indexApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var _parsedArgs$type = parsedArgs.type,\n      type = _parsedArgs$type === undefined ? '_doc' : _parsedArgs$type,\n      id = parsedArgs.id,\n      body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  delete parsedArgs.id;\n  var path = void 0;\n\n  if (id) {\n    path = type ? type + '/' + encodeURIComponent(id) : encodeURIComponent(id);\n  } else {\n    path = type;\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * Get Service\n * @param {Object} args\n * @param {String} args.type\n * @param {String} args.id\n */\n\n\nfunction getApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    id: 'string|number'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var _parsedArgs$type = parsedArgs.type,\n      type = _parsedArgs$type === undefined ? '_doc' : _parsedArgs$type,\n      id = parsedArgs.id;\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  var path = type + '/' + encodeURIComponent(id);\n  return this.performFetchRequest({\n    method: 'GET',\n    path: path,\n    params: parsedArgs\n  });\n}\n/**\n * Update Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {String} args.id\n */\n\n\nfunction updateApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    id: 'string|number',\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var _parsedArgs$type = parsedArgs.type,\n      type = _parsedArgs$type === undefined ? '_doc' : _parsedArgs$type,\n      id = parsedArgs.id,\n      body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  delete parsedArgs.body;\n  var path = type + '/' + encodeURIComponent(id) + '/_update';\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * Delete Service\n * @param {Object} args\n * @param {String} args.type\n * @param {String} args.id\n */\n\n\nfunction deleteApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    id: 'string|number'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var _parsedArgs$type = parsedArgs.type,\n      type = _parsedArgs$type === undefined ? '_doc' : _parsedArgs$type,\n      id = parsedArgs.id;\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  var path = type + '/' + encodeURIComponent(id);\n  return this.performFetchRequest({\n    method: 'DELETE',\n    path: path,\n    params: parsedArgs\n  });\n}\n/**\n * Bulk Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\n\n\nfunction bulkApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  var path = void 0;\n\n  if (type) {\n    path = type + '/_bulk';\n  } else {\n    path = '_bulk';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * Search Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\n\n\nfunction searchApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = void 0;\n\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    // eslint-disable-next-line\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  var path = void 0;\n\n  if (type) {\n    path = type + '/_search';\n  } else {\n    path = '_search';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * Msearch Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\n\n\nfunction msearchApi(args) {\n  var parsedArgs = removeUndefined(args); // Validate arguments\n\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = void 0;\n\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  var path = void 0;\n\n  if (type) {\n    path = type + '/_msearch';\n  } else {\n    path = '_msearch';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n/**\n * ReactiveSearch API Service for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\n\n\nfunction reactiveSearchApi(query, settings) {\n  var parsedSettings = removeUndefined(settings); // Validate query\n\n  var valid = validateRSQuery(query);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch',\n    body: body,\n    headers: getTelemetryHeaders(this.enableTelemetry),\n    isRSAPI: true\n  });\n}\n/**\n * ReactiveSearch API Service for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\n\n\nfunction reactiveSearchv3Api(query, settings) {\n  var parsedSettings = removeUndefined(settings); // Validate query\n\n  var valid = validateRSQuery(query);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch.v3',\n    body: body,\n    headers: getTelemetryHeaders(this.enableTelemetry),\n    isRSAPI: true\n  });\n}\n/**\n * To get mappings\n */\n\n\nfunction getMappings() {\n  return this.performFetchRequest({\n    method: 'GET',\n    path: '_mapping'\n  });\n}\n/**\n * ReactiveSearch suggestions API for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\n\n\nfunction getSuggestionsv3Api(query, settings) {\n  var parsedSettings = removeUndefined(settings); // Validate query\n\n  var valid = validateRSQuery(query);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch.v3',\n    body: body,\n    headers: getTelemetryHeaders(this.enableTelemetry),\n    isRSAPI: true,\n    isSuggestionsAPI: true\n  });\n}\n\nfunction appbasejs(config) {\n  var client = new AppBase(config);\n  AppBase.prototype.performFetchRequest = fetchRequest;\n  AppBase.prototype.index = indexApi;\n  AppBase.prototype.get = getApi;\n  AppBase.prototype.update = updateApi;\n  AppBase.prototype.delete = deleteApi;\n  AppBase.prototype.bulk = bulkApi;\n  AppBase.prototype.search = searchApi;\n  AppBase.prototype.msearch = msearchApi;\n  AppBase.prototype.reactiveSearch = reactiveSearchApi;\n  AppBase.prototype.reactiveSearchv3 = reactiveSearchv3Api;\n  AppBase.prototype.getQuerySuggestions = getSuggestionsv3Api;\n  AppBase.prototype.getMappings = getMappings;\n\n  AppBase.prototype.setHeaders = function setHeaders() {\n    var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var shouldEncode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false; // Encode headers\n\n    if (shouldEncode) {\n      this.headers = encodeHeaders(headers);\n    } else {\n      this.headers = headers;\n    }\n  };\n\n  if (typeof window !== 'undefined') {\n    window.Appbase = client;\n  }\n\n  return client;\n}\n\nexport default appbasejs;","map":{"version":3,"sources":["/home/ma/soulmed-healthcare/soulmed/node_modules/appbase-js/dist/appbase-js.es.js"],"names":["URL","querystring","fetch","_typeof","Symbol","iterator","obj","constructor","prototype","contains","string","substring","indexOf","isAppbase","url","btoa","input","arguments","length","undefined","chars","str","output","block","charCode","i","map","charAt","charCodeAt","Error","validateRSQuery","query","Object","toString","call","q","id","validate","object","fields","invalid","emptyFor","number","keys","forEach","key","types","split","matchedType","find","type","push","missing","removeUndefined","value","JSON","parse","stringify","encodeHeaders","headers","shouldEncode","encodedHeaders","header","encodeURI","getTelemetryHeaders","enableTelemetry","assign","AppBase","config","_URL","_URL$auth","auth","_URL$host","host","_URL$path","path","_URL$protocol","protocol","app","slice","credentials","username","password","fetchRequest","args","_this","Promise","resolve","reject","parsedArgs","method","params","body","isRSAPI","isSuggestionsAPI","bodyCopy","contentType","endsWith","Accept","timestamp","Date","now","Authorization","requestOptions","Array","isArray","arrayBody","item","handleTransformRequest","res","transformRequest","tarnsformRequestPromise","responseHeaders","paramsString","finalURL","then","ts","transformedRequest","getTime","status","json","data","error","errorResponses","allResponses","filter","execute","hasOwnProperty","responses","_allResponses","_errorResponses","entry","response","_timestamp","_headers","catch","e","err","indexApi","valid","_parsedArgs$type","encodeURIComponent","performFetchRequest","getApi","updateApi","deleteApi","bulkApi","searchApi","join","msearchApi","reactiveSearchApi","settings","parsedSettings","reactiveSearchv3Api","getMappings","getSuggestionsv3Api","appbasejs","client","index","get","update","delete","bulk","search","msearch","reactiveSearch","reactiveSearchv3","getQuerySuggestions","setHeaders","window","Appbase"],"mappings":"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","sourcesContent":["import URL from 'url-parser-lite';\nimport querystring from 'querystring';\nimport fetch from 'cross-fetch';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\nfunction contains(string, substring) {\n  return string.indexOf(substring) !== -1;\n}\nfunction isAppbase(url) {\n  return contains(url, 'scalr.api.appbase.io');\n}\nfunction btoa() {\n  var input = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n\n  var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  var str = input;\n  var output = '';\n\n  // eslint-disable-next-line\n  for (var block = 0, charCode, i = 0, map = chars; str.charAt(i | 0) || (map = '=', i % 1); // eslint-disable-line no-bitwise\n  output += map.charAt(63 & block >> 8 - i % 1 * 8) // eslint-disable-line no-bitwise\n  ) {\n    charCode = str.charCodeAt(i += 3 / 4);\n\n    if (charCode > 0xff) {\n      throw new Error('\"btoa\" failed: The string to be encoded contains characters outside of the Latin1 range.');\n    }\n\n    block = block << 8 | charCode; // eslint-disable-line no-bitwise\n  }\n\n  return output;\n}\n\nfunction validateRSQuery(query) {\n  if (query && Object.prototype.toString.call(query) === '[object Array]') {\n    for (var i = 0; i < query.length; i += 1) {\n      var q = query[i];\n      if (q) {\n        if (!q.id) {\n          return new Error(\"'id' field must be present in query object\");\n        }\n      } else {\n        return new Error('query object can not have an empty value');\n      }\n    }\n    return true;\n  }\n  return new Error(\"invalid query value, 'query' value must be an array\");\n}\n\nfunction validate(object, fields) {\n  var invalid = [];\n  var emptyFor = {\n    object: null,\n    string: '',\n    number: 0\n  };\n  var keys = Object.keys(fields);\n  keys.forEach(function (key) {\n    var types = fields[key].split('|');\n    var matchedType = types.find(function (type) {\n      return (\n        // eslint-disable-next-line\n        _typeof(object[key]) === type\n      );\n    });\n    if (!matchedType || object[key] === emptyFor[matchedType]) {\n      invalid.push(key);\n    }\n  });\n  var missing = '';\n  for (var i = 0; i < invalid.length; i += 1) {\n    missing += invalid[i] + ', ';\n  }\n  if (invalid.length > 0) {\n    return new Error('fields missing: ' + missing);\n  }\n\n  return true;\n}\n\nfunction removeUndefined() {\n  var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (value || !(Object.keys(value).length === 0 && value.constructor === Object)) {\n    return JSON.parse(JSON.stringify(value));\n  }\n  return null;\n}\n\nfunction encodeHeaders() {\n  var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var shouldEncode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n  // Encode headers\n  var encodedHeaders = {};\n  if (shouldEncode) {\n    Object.keys(headers).forEach(function (header) {\n      encodedHeaders[header] = encodeURI(headers[header]);\n    });\n  } else {\n    encodedHeaders = headers;\n  }\n  return encodedHeaders;\n}\n\nfunction getTelemetryHeaders(enableTelemetry) {\n  var headers = {};\n  Object.assign(headers, {\n    'X-Search-Client': 'Appbase JS'\n  });\n  if (enableTelemetry === false) {\n    Object.assign(headers, {\n      'X-Enable-Telemetry': enableTelemetry\n    });\n  }\n\n  return headers;\n}\n\n/**\n * Returns an instance of Appbase client\n * @param {Object} config To configure properties\n * @param {String} config.url\n * @param {String} config.app\n * @param {String} config.credentials\n * @param {String} config.username\n * @param {String} config.password\n * @param {Boolean} config.enableTelemetry\n * A callback function which will be invoked before a fetch request made\n */\nfunction AppBase(config) {\n  var _URL = URL(config.url || ''),\n      _URL$auth = _URL.auth,\n      auth = _URL$auth === undefined ? null : _URL$auth,\n      _URL$host = _URL.host,\n      host = _URL$host === undefined ? '' : _URL$host,\n      _URL$path = _URL.path,\n      path = _URL$path === undefined ? '' : _URL$path,\n      _URL$protocol = _URL.protocol,\n      protocol = _URL$protocol === undefined ? '' : _URL$protocol;\n\n  var url = host + path;\n\n  // Validate config and throw appropriate error\n  if (typeof url !== 'string' || url === '') {\n    throw new Error('URL not present in options.');\n  }\n  if (typeof config.app !== 'string' || config.app === '') {\n    throw new Error('App name is not present in options.');\n  }\n  if (typeof protocol !== 'string' || protocol === '') {\n    throw new Error('Protocol is not present in url. URL should be of the form https://appbase-demo-ansible-abxiydt-arc.searchbase.io');\n  }\n  // Parse url\n  if (url.slice(-1) === '/') {\n    url = url.slice(0, -1);\n  }\n  var credentials = auth || null;\n  /**\n   * Credentials can be provided as a part of the URL,\n   * as username, password args or as a credentials argument directly */\n  if (typeof config.credentials === 'string' && config.credentials !== '') {\n    // eslint-disable-next-line\n    credentials = config.credentials;\n  } else if (typeof config.username === 'string' && config.username !== '' && typeof config.password === 'string' && config.password !== '') {\n    credentials = config.username + ':' + config.password;\n  }\n\n  if (isAppbase(url) && credentials === null) {\n    throw new Error('Authentication information is not present. Did you add credentials?');\n  }\n  this.url = url;\n  this.protocol = protocol;\n  this.app = config.app;\n  this.credentials = credentials;\n  if (typeof config.enableTelemetry === 'boolean') {\n    this.enableTelemetry = config.enableTelemetry;\n  }\n}\n\n/**\n * To perform fetch request\n * @param {Object} args\n * @param {String} args.method\n * @param {String} args.path\n * @param {Object} args.params\n * @param {Object} args.body\n * @param {Object} args.headers\n * @param {boolean} args.isSuggestionsAPI\n */\nfunction fetchRequest(args) {\n  var _this = this;\n\n  return new Promise(function (resolve, reject) {\n    var parsedArgs = removeUndefined(args);\n    try {\n      var method = parsedArgs.method,\n          path = parsedArgs.path,\n          params = parsedArgs.params,\n          body = parsedArgs.body,\n          isRSAPI = parsedArgs.isRSAPI,\n          isSuggestionsAPI = parsedArgs.isSuggestionsAPI;\n\n      var app = isSuggestionsAPI ? '.suggestions' : _this.app;\n      var bodyCopy = body;\n      var contentType = path.endsWith('msearch') || path.endsWith('bulk') ? 'application/x-ndjson' : 'application/json';\n      var headers = Object.assign({}, {\n        Accept: 'application/json',\n        'Content-Type': contentType\n      }, args.headers, _this.headers);\n      var timestamp = Date.now();\n      if (_this.credentials) {\n        headers.Authorization = 'Basic ' + btoa(_this.credentials);\n      }\n      var requestOptions = {\n        method: method,\n        headers: headers\n      };\n      if (Array.isArray(bodyCopy)) {\n        var arrayBody = '';\n        bodyCopy.forEach(function (item) {\n          arrayBody += JSON.stringify(item);\n          arrayBody += '\\n';\n        });\n\n        bodyCopy = arrayBody;\n      } else {\n        bodyCopy = JSON.stringify(bodyCopy) || {};\n      }\n\n      if (Object.keys(bodyCopy).length !== 0) {\n        requestOptions.body = bodyCopy;\n      }\n\n      var handleTransformRequest = function handleTransformRequest(res) {\n        if (_this.transformRequest && typeof _this.transformRequest === 'function') {\n          var tarnsformRequestPromise = _this.transformRequest(res);\n          return tarnsformRequestPromise instanceof Promise ? tarnsformRequestPromise : Promise.resolve(tarnsformRequestPromise);\n        }\n        return Promise.resolve(res);\n      };\n\n      var responseHeaders = {};\n\n      var paramsString = '';\n      if (params) {\n        paramsString = '?' + querystring.stringify(params);\n      }\n      var finalURL = _this.protocol + '://' + _this.url + '/' + app + '/' + path + paramsString;\n      return handleTransformRequest(Object.assign({}, {\n        url: finalURL\n      }, requestOptions)).then(function (ts) {\n        var transformedRequest = Object.assign({}, ts);\n        var url = transformedRequest.url;\n\n        delete transformedRequest.url;\n        return fetch(url || finalURL, Object.assign({}, transformedRequest, {\n          // apply timestamp header for RS API\n          headers: isRSAPI ? Object.assign({}, transformedRequest.headers, {\n            'x-timestamp': new Date().getTime()\n          }) : transformedRequest.headers\n        })).then(function (res) {\n          if (res.status >= 500) {\n            return reject(res);\n          }\n          responseHeaders = res.headers;\n          return res.json().then(function (data) {\n            if (res.status >= 400) {\n              return reject(res);\n            }\n            if (data && data.error) {\n              return reject(data);\n            }\n            // Handle error from RS API RESPONSE\n            if (isRSAPI && data && Object.prototype.toString.call(data) === '[object Object]') {\n              if (body && body.query && body.query instanceof Array) {\n                var errorResponses = 0;\n                var allResponses = body.query.filter(function (q) {\n                  return q.execute || q.execute === undefined;\n                }).length;\n                if (data) {\n                  Object.keys(data).forEach(function (key) {\n                    if (data[key] && Object.prototype.hasOwnProperty.call(data[key], 'error')) {\n                      errorResponses += 1;\n                    }\n                  });\n                }\n                // reject only when all responses has error\n                if (errorResponses > 0 && allResponses === errorResponses) {\n                  return reject(data);\n                }\n              }\n            }\n\n            // Handle error from _msearch response\n            if (data && data.responses instanceof Array) {\n              var _allResponses = data.responses.length;\n              var _errorResponses = data.responses.filter(function (entry) {\n                return Object.prototype.hasOwnProperty.call(entry, 'error');\n              }).length;\n              // reject only when all responses has error\n              if (_allResponses === _errorResponses) {\n                return reject(data);\n              }\n            }\n            var response = Object.assign({}, data, {\n              _timestamp: timestamp,\n              _headers: responseHeaders\n            });\n            return resolve(response);\n          }).catch(function (e) {\n            return reject(e);\n          });\n        }).catch(function (e) {\n          return reject(e);\n        });\n      }).catch(function (err) {\n        return reject(err);\n      });\n    } catch (e) {\n      return reject(e);\n    }\n  });\n}\n\n/**\n * Index Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {String} args.id\n */\nfunction indexApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n  var _parsedArgs$type = parsedArgs.type,\n      type = _parsedArgs$type === undefined ? '_doc' : _parsedArgs$type,\n      id = parsedArgs.id,\n      body = parsedArgs.body;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n  delete parsedArgs.id;\n\n  var path = void 0;\n  if (id) {\n    path = type ? type + '/' + encodeURIComponent(id) : encodeURIComponent(id);\n  } else {\n    path = type;\n  }\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * Get Service\n * @param {Object} args\n * @param {String} args.type\n * @param {String} args.id\n */\nfunction getApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    id: 'string|number'\n  });\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var _parsedArgs$type = parsedArgs.type,\n      type = _parsedArgs$type === undefined ? '_doc' : _parsedArgs$type,\n      id = parsedArgs.id;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n\n  var path = type + '/' + encodeURIComponent(id);\n\n  return this.performFetchRequest({\n    method: 'GET',\n    path: path,\n    params: parsedArgs\n  });\n}\n\n/**\n * Update Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n * @param {String} args.id\n */\nfunction updateApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    id: 'string|number',\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var _parsedArgs$type = parsedArgs.type,\n      type = _parsedArgs$type === undefined ? '_doc' : _parsedArgs$type,\n      id = parsedArgs.id,\n      body = parsedArgs.body;\n\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n  delete parsedArgs.body;\n  var path = type + '/' + encodeURIComponent(id) + '/_update';\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * Delete Service\n * @param {Object} args\n * @param {String} args.type\n * @param {String} args.id\n */\nfunction deleteApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    id: 'string|number'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var _parsedArgs$type = parsedArgs.type,\n      type = _parsedArgs$type === undefined ? '_doc' : _parsedArgs$type,\n      id = parsedArgs.id;\n\n  delete parsedArgs.type;\n  delete parsedArgs.id;\n\n  var path = type + '/' + encodeURIComponent(id);\n\n  return this.performFetchRequest({\n    method: 'DELETE',\n    path: path,\n    params: parsedArgs\n  });\n}\n\n/**\n * Bulk Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\nfunction bulkApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = parsedArgs.type,\n      body = parsedArgs.body;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n\n  var path = void 0;\n  if (type) {\n    path = type + '/_bulk';\n  } else {\n    path = '_bulk';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * Search Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\nfunction searchApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = void 0;\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    // eslint-disable-next-line\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n\n  var path = void 0;\n  if (type) {\n    path = type + '/_search';\n  } else {\n    path = '_search';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * Msearch Service\n * @param {Object} args\n * @param {String} args.type\n * @param {Object} args.body\n */\nfunction msearchApi(args) {\n  var parsedArgs = removeUndefined(args);\n  // Validate arguments\n  var valid = validate(parsedArgs, {\n    body: 'object'\n  });\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var type = void 0;\n  if (Array.isArray(parsedArgs.type)) {\n    type = parsedArgs.type.join();\n  } else {\n    type = parsedArgs.type;\n  }\n\n  var body = parsedArgs.body;\n\n\n  delete parsedArgs.type;\n  delete parsedArgs.body;\n\n  var path = void 0;\n  if (type) {\n    path = type + '/_msearch';\n  } else {\n    path = '_msearch';\n  }\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: path,\n    params: parsedArgs,\n    body: body\n  });\n}\n\n/**\n * ReactiveSearch API Service for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\nfunction reactiveSearchApi(query, settings) {\n  var parsedSettings = removeUndefined(settings);\n\n  // Validate query\n  var valid = validateRSQuery(query);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch',\n    body: body,\n    headers: getTelemetryHeaders(this.enableTelemetry),\n    isRSAPI: true\n  });\n}\n\n/**\n * ReactiveSearch API Service for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\nfunction reactiveSearchv3Api(query, settings) {\n  var parsedSettings = removeUndefined(settings);\n\n  // Validate query\n  var valid = validateRSQuery(query);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch.v3',\n    body: body,\n    headers: getTelemetryHeaders(this.enableTelemetry),\n    isRSAPI: true\n  });\n}\n\n/**\n * To get mappings\n */\nfunction getMappings() {\n  return this.performFetchRequest({\n    method: 'GET',\n    path: '_mapping'\n  });\n}\n\n/**\n * ReactiveSearch suggestions API for v3\n * @param {Array<Object>} query\n * @param {Object} settings\n * @param {boolean} settings.recordAnalytics\n * @param {boolean} settings.userId\n * @param {boolean} settings.enableQueryRules\n * @param {boolean} settings.customEvents\n */\nfunction getSuggestionsv3Api(query, settings) {\n  var parsedSettings = removeUndefined(settings);\n\n  // Validate query\n  var valid = validateRSQuery(query);\n\n  if (valid !== true) {\n    throw valid;\n  }\n\n  var body = {\n    settings: parsedSettings,\n    query: query\n  };\n\n  return this.performFetchRequest({\n    method: 'POST',\n    path: '_reactivesearch.v3',\n    body: body,\n    headers: getTelemetryHeaders(this.enableTelemetry),\n    isRSAPI: true,\n    isSuggestionsAPI: true\n  });\n}\n\nfunction appbasejs(config) {\n  var client = new AppBase(config);\n\n  AppBase.prototype.performFetchRequest = fetchRequest;\n\n  AppBase.prototype.index = indexApi;\n\n  AppBase.prototype.get = getApi;\n\n  AppBase.prototype.update = updateApi;\n\n  AppBase.prototype.delete = deleteApi;\n\n  AppBase.prototype.bulk = bulkApi;\n\n  AppBase.prototype.search = searchApi;\n\n  AppBase.prototype.msearch = msearchApi;\n\n  AppBase.prototype.reactiveSearch = reactiveSearchApi;\n\n  AppBase.prototype.reactiveSearchv3 = reactiveSearchv3Api;\n\n  AppBase.prototype.getQuerySuggestions = getSuggestionsv3Api;\n\n  AppBase.prototype.getMappings = getMappings;\n\n  AppBase.prototype.setHeaders = function setHeaders() {\n    var headers = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    var shouldEncode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    // Encode headers\n    if (shouldEncode) {\n      this.headers = encodeHeaders(headers);\n    } else {\n      this.headers = headers;\n    }\n  };\n\n  if (typeof window !== 'undefined') {\n    window.Appbase = client;\n  }\n  return client;\n}\n\nexport default appbasejs;\n"]},"metadata":{},"sourceType":"module"}